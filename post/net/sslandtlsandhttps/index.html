<!doctype html><html lang=zh-tw data-theme=light><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.112.3"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="SSlAndTLS"><meta itemprop=description content="筆記 | 軟體 | 架構 | Java"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://iankingh.github.io/imgs/author.png"><meta itemprop=keywords content="SSL,TLS"><meta property="og:type" content="article"><meta property="og:title" content="SSlAndTLS"><meta property="og:description" content="筆記 | 軟體 | 架構 | Java"><meta property="og:image" content="/imgs/author.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://iankingh.github.io/blog/post/net/sslandtlsandhttps/"><meta property="og:site_name" content="ianhuang筆記"><meta property="og:locale" content="zh-TW"><meta property="article:author" content="Ian Huang"><meta property="article:published_time" content="2020-12-23 11:38:01 +0800 CST"><meta property="article:modified_time" content="2020-12-23 11:38:01 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/blog/css/main.min.73f0e754080bf15d64bb86079b48ac04381411eaae62226d01abc2548ffcf3b5.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"sslandtlsandhttps","permalink":"https://iankingh.github.io/blog/post/net/sslandtlsandhttps/","title":"SSlAndTLS","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://www.googletagmanager.com/gtag/js?id=G-WF6NBSJFE5",e.async="true",e.onload=function(){window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date),e("config","G-WF6NBSJFE5 ")},document.head.appendChild(e)})</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>SSlAndTLS - ianhuang筆記</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>ianhuang筆記</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>總有一天，你的日積月累，會變成他人的望塵莫及</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/blog/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首頁</a></li><li class="menu-item menu-item-code"><a href=/blog/categories/%E6%8A%80%E8%A1%93/ class=hvr-icon-pulse rel=section><i class="fa fa-code hvr-icon"></i>技術</a></li><li class="menu-item menu-item-book"><a href=/blog/categories/%E7%AD%86%E8%A8%98/ class=hvr-icon-pulse rel=section><i class="fa fa-book hvr-icon"></i>筆記</a></li><li class="menu-item menu-item-archives"><a href=/blog/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>歸檔
<span class=badge>73</span></a></li><li class="menu-item menu-item-about"><a href=/blog/about/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>關於</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目錄</li><li class=sidebar-nav-overview>站點概覽</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#ssl憑證ssl-certificate的原理>SSL憑證(SSL certificate)的原理</a><ul><li><a href=#ssl-handshake>SSL Handshake</a></li></ul></li><li><a href=#tls>TLS</a><ul><li><a href=#tls-運作原理>TLS 運作原理</a></li><li><a href=#tcp-three-way-handshake>TCP Three-way Handshake</a></li><li><a href=#https>HTTPS</a></li><li><a href=#憑證的信任機制>憑證的信任機制</a></li><li><a href=#數位簽章>數位簽章</a></li><li><a href=#常見的狀況自簽憑證>常見的狀況：自簽憑證</a></li><li><a href=#機制弱點>機制弱點</a></li></ul></li><li><a href=#ssl-相關名詞>SSL 相關名詞</a><ul><li><ul><li><a href=#tls-transport-layer-security-protocol>TLS: Transport Layer Security Protocol</a></li><li><a href=#ca-certificate-authority>CA: Certificate Authority</a></li><li><a href=#chain-of-trust>Chain of Trust</a></li></ul></li></ul></li><li><a href=#參考>參考</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt="Ian Huang" src=/imgs/img-lazy-loading.gif data-src=/imgs/author.png><p class=site-author-name itemprop=name>Ian Huang</p><div class=site-description itemprop=description>筆記 | 軟體 | 架構 | Java</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>73</span>
<span class=site-state-item-name>日誌</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>6</span>
<span class=site-state-item-name>分類</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>52</span>
<span class=site-state-item-name>標籤</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/iankingh title="Github → https://github.com/iankingh" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>網站資訊</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已運行：</div><div class=item-count id=runTimes data-publishdate=2020-04-21T22:29:36+08:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>總訪客數：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>頁面瀏覽：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>總字數：</div><div class=item-count id=wordsCount data-count=64747></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>閱讀約：</div><div class=item-count id=readTimes data-times=171></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最後更新於：</div><div class=item-count id=last-push-date data-lastpushdate=2023-08-02T07:38:35+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-gtranslate class=button title=多語言翻譯><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深淺模式切換><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回頂部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/iankingh rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://iankingh.github.io/blog/post/net/sslandtlsandhttps/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image src=/imgs/author.png><meta itemprop=name content="Ian Huang"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Ian Huang"><meta itemprop=description content="筆記 | 軟體 | 架構 | Java"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="SSlAndTLS"><meta itemprop=description content="SSL、TLS 以及 HTTPS

當我們瀏覽網頁時：網址列的開頭是不是有個 🔒鎖的圖案。
這個鎖代表你現在連線到的網站是安全可信任的。
即使用

    HTTPS (HTTP Secure)
    
    
    
 連線，而不是使用不安全的

     HTTP protocol
    
    
    
。"></span><header class=post-header><h1 class=post-title itemprop="name headline">SSlAndTLS
<a href=https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/post/net/SSLandTLSandHttps.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=編輯><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text title=發表於>發表於：</span>
<time title="創建時間：2020-12-23 11:38:01 +0800 CST" itemprop="dateCreated datePublished" datetime="2020-12-23 11:38:01 +0800 CST">2020-12-23</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text title=分類於>分類於：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E7%AD%86%E8%A8%98 itemprop=url rel=index><span itemprop=name>筆記</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字數><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字數：</span>
<span>6952</span></span>
<span class=post-meta-item title=閱讀><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>閱讀：&ap;</span>
<span>14分鐘</span></span>
<span class=post-meta-item title=瀏覽><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>瀏覽：</span>
<span id=busuanzi_value_page_pv data-path=/blog/post/net/sslandtlsandhttps/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h1 id=ssltls-以及-https>SSL、TLS 以及 HTTPS
<a class=header-anchor href=#ssltls-%e4%bb%a5%e5%8f%8a-https></a></h1><p>當我們瀏覽網頁時：網址列的開頭是不是有個 🔒鎖的圖案。</p><p>這個鎖代表你現在連線到的網站是安全可信任的。</p><p>即使用
<a href=https://en.wikipedia.org/wiki/HTTPS title="HTTPS (HTTP Secure)" rel="noopener external nofollow noreferrer" target=_blank class=exturl>HTTPS (HTTP Secure)
<i class="fa fa-external-link-alt"></i></a> 連線，而不是使用不安全的
<a href=https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol title=" HTTP protocol" rel="noopener external nofollow noreferrer" target=_blank class=exturl>HTTP protocol
<i class="fa fa-external-link-alt"></i>
</a>。</p><h2 id=ssl憑證ssl-certificate的原理>SSL憑證(SSL certificate)的原理
<a class=header-anchor href=#ssl%e6%86%91%e8%ad%89ssl-certificate%e7%9a%84%e5%8e%9f%e7%90%86></a></h2><p>SSL 的全名是 <strong>Secure Sockets Layer</strong>，即安全通訊端層，這是一種標準的技術，用於保持網際網路連線安全以及防止在兩個系統之間發送的所有敏感資料被罪犯讀取及修改任何傳輸的資訊，包括潛在的個人詳細資料。兩個系統可以是伺服器與用戶端 (例如購物網站與瀏覽器)，或者伺服器至伺服器 (例如，含有個人身份資訊或含有薪資資訊的應用程式)。</p><p>這樣做是為了確保使用者與網站、或兩個系統之間傳輸的任何資料保持無法被讀取的狀態。此技術可使用加密演算法以混淆輸送中的資料，防止駭客在資料透過連線發送時讀取資料。此資訊可能是任何敏感或個人資訊，包括信用卡號與其他財務資訊、姓名與地址。</p><p>SSL 讓瀏覽器（所謂的 client）要連到一個遠端網站（所謂的 server）之前，先要求這個網站提供身分認證，跟這個網站約定暗號（交換鑰匙），打好交情（建立加密的 session），才會心甘情願地跟這個網站連線。</p><p>總共有 三個步驟 1. 建立連線 2. 憑證交換 3. 金鑰交換</p><p>步驟如下：</p><p>1.1 建立連線 - 客戶端和伺服器官表示想要發起 HTTPS 連線，說明自己支持的 SSL/TLS 版本和加密算法。伺服器端會回應客戶端說可以使用哪一種組合。瀏覽器對想要連線的網站送出連線請求，同時要求網站驗證自己。</p><p>2.1 憑證交換 - 伺服器必須照明_自己是誰_。伺服器會拿出一張憑證，基本上這張憑證記載了伺服器的身份、位置（網址）、憑證的公鑰、有效日期和數位簽章。客戶端會確認是否要相信這張憑證，要麼這張憑證是被設定要信任，要麼這張憑證是由某個信任的機構 (CA) 簽署的。另外，這個機制其實可以雙向使用，伺服器端驗證客戶端的身份，不過這個機制很少用到</p><p>2.2 憑證交換 - 網站將自己的 SSL 數位憑證 (SSL certificate) 回傳給 client，裡面包含了網站的 public key</p><p>2.3 憑證交換 - 瀏覽器驗證網站回傳的的 root certificate，透過
<a href=https://jennycodes.me/posts/security-ssl-https#chainoftrust title="chain of trust 機制" rel="noopener external nofollow noreferrer" target=_blank class=exturl>chain of trust 機制
<i class="fa fa-external-link-alt"></i></a> 確認這個證明文件是否可以被信認，同時也確認這個憑證是否過期。</p><p>3.1 金鑰交換- 當認證通過，瀏覽器會用網站的 public key 建立一個
<a href=https://en.wikipedia.org/wiki/Session_key title="symmetric session key" rel="noopener external nofollow noreferrer" target=_blank class=exturl>symmetric session key
<i class="fa fa-external-link-alt"></i>
</a>。</p><p>3.2 金鑰交換 - 網站用自己的 private key 解讀 session key，並且回傳一個確認訊息，開始一個被 SSL 保護的 session。</p><p>3.3 金鑰交換 - 這個 session key 會被用來加密所有之後瀏覽器與網站之間傳送的資料。</p><h3 id=ssl-handshake>SSL Handshake
<a class=header-anchor href=#ssl-handshake></a></h3><p>在 TCP Three-way Handshake 完成之後，如果 Alice 有希望使用 SSL 加密時就會開始做 SSL Handshake。</p><p>時序圖如下：</p><p>SSL在傳輸之前事先用來溝通雙方（用戶端與伺服器端）所使用的加密演算法或密鑰交換演算法，或是在伺服器和用戶端之間安全地交換密鑰及雙方的身分認證等相關規則，讓雙方有所遵循。在身分認證方面，SSLHandshake可用來認證伺服器的身分。SSL Handshake的運作流程如下所述：</p><p>(1) SSL用戶端利用Client Hello訊息將本身支援的SSL版本、加密演算法、演算法等資訊發送給SSL伺服器。</p><p>(2) SSL伺服器收到Client Hello訊息並確定本次通訊採用的SSL版本和加密套件後，利用Server Hello訊息回覆給SSL用戶端。</p><p>(3) SSL伺服器將利用Certificate訊息將本身公鑰的數位憑證傳給SSL用戶端。</p><p>(4) SSL伺服器發送Server Hello Done訊息，通知SSL用戶端版本和加密套件協商結束，並開始進行密鑰交換。</p><p>(5) 當SSL用戶端驗證SSL伺服器的證書合法後，利用伺服器的證書中之公鑰加密SSL用戶端隨機生成的Premaster Secret（這是一個用在對稱加密密鑰產生中的46位元組的亂數字），並透過Client Key Exchange消息發送給SSL伺服器。</p><p>(6) SSL用戶端發送Change Cipher Spec消息，通知SSL伺服器後續報文將採用協商好的密鑰和加密套件進行加密。</p><p>(7) SSL用戶端計算已交互的握手消息的Hash值，利用協商好的密鑰和加密演算法處理Hash值，並透過Finished消息發送給SSL伺服器。SSL伺服器利用同樣的方法計算已交互的握手消息的Hash值，並與Finished消息的解密結果比較，如果兩者相同，則證明密鑰和加密套件協商成功。</p><p>(8) SSL伺服器發送Change Cipher Spec訊息，通知SSL用戶端後續傳輸將採用協商好的密鑰和加密套件進行加密。</p><p>(9) SSL伺服器計算已交互的握手消息的Hash值，利用協商好的密鑰和加密套件處理Hash值，並透過Finished消息發送給SSL用戶端。SSL用戶端利用同樣的方法計算已交互的握手消息的Hash值，並與Finished消息的解密結果比較，如果兩者相同，且MAC值驗證成功，則證明密鑰和加密套件協商成功。在SSL用戶端接收到SSL伺服器發送的Finished消息後，如果解密成功，則可以判斷SSL伺服器是數位證書的擁有者，即SSL伺服器身分驗證成功。這是因為只有擁有私鑰的SSL伺服器才能從Client Key Exchange消息中解密得到Premaster Secret，從而間接地實現了SSL用戶端對SSL伺服器的身分驗證。</p><ul><li><code>SSL 1.0</code> 是由 Netscape 設計的，但時間不詳。</li><li><code>SSL 2.0</code> 1995 年發布，2011 年棄用。</li><li><code>SSL 3.0</code> 1996 年發布，2015 年棄用。後來 IETF 也將此協定特別發布了
<a href=https://tools.ietf.org/html/rfc6101 title="RFC      6101" rel="noopener external nofollow noreferrer" target=_blank class=exturl>RFC 6101
<i class="fa fa-external-link-alt"></i></a> 作為歷史記錄。</li></ul><h2 id=tls>TLS
<a class=header-anchor href=#tls></a></h2><p>TSL 的全名是 Transport Layer Security 傳輸層安全性)是更新、更安全的 SSL 版本。我們仍將安全性憑證稱為 SSL，因為這是較常用的詞彙，不過當您透過DigiCert
<a href="https://www.websecurity.digicert.com/zh/tw/ssl-certificate?inid=infoctr_buylink_sslhome" title="購買 SSL " rel="noopener external nofollow noreferrer" target=_blank class=exturl>購買 SSL
<i class="fa fa-external-link-alt"></i>
</a>時，您所購買的其實是最新的 TLS 憑證及
<a href=https://www.websecurity.digicert.com/zh/tw/security-topics/how-ssl-works title="ECC、RSA 或 DSA 的加密選項" rel="noopener external nofollow noreferrer" target=_blank class=exturl>ECC、RSA 或 DSA 的加密選項
<i class="fa fa-external-link-alt"></i>
</a>。</p><ul><li><code>TLS 1.0</code> 1999 年 IETF 將 SSL 標準化，發布了
<a href=https://tools.ietf.org/html/rfc2246 title="RFC      2246" rel="noopener external nofollow noreferrer" target=_blank class=exturl>RFC 2246
<i class="fa fa-external-link-alt"></i>
</a>，同時改名為 TLS。也因此 SSL 3.0 和 TLS 1.0 其實沒有什麼太大差別，甚至可以說是一樣的東西。而 TLS 1.0 也支援相容 SSL 3.0 的功能，但這做法同時也降低了安全性。</li><li><code>TLS 1.1</code> 2006 年發布
<a href=https://tools.ietf.org/html/rfc4346 title="RFC      4346" rel="noopener external nofollow noreferrer" target=_blank class=exturl>RFC 4346
<i class="fa fa-external-link-alt"></i>
</a>，雖然目前沒什麼問題，還是計劃於 2020 年棄用</li><li><code>TLS 1.2</code> 2008 年發布
<a href=https://tools.ietf.org/html/rfc5246 title="RFC      5246" rel="noopener external nofollow noreferrer" target=_blank class=exturl>RFC 5246
<i class="fa fa-external-link-alt"></i>
</a>，可運作在 HTTP/2 上。</li><li>2014 年，Google 發現了 SSL 3.0 有致命的安全性漏洞，加上 TLS 1.0 因為加密模式設計不良，會
<a href=http://securityalley.blogspot.com/2014/07/ssltls-beast.html title=造成加密內容被解密 rel="noopener external nofollow noreferrer" target=_blank class=exturl>造成加密內容被解密
<i class="fa fa-external-link-alt"></i>
</a>，因此馬上變成主要的資安檢核項目之一，建議早日關閉。</li><li><code>TLS 1.3</code> 2018 年發布
<a href=https://tools.ietf.org/html/rfc8446 title="RFC      8446" rel="noopener external nofollow noreferrer" target=_blank class=exturl>RFC 8446
<i class="fa fa-external-link-alt"></i></a></li></ul><p>注意看了一下，TLS 每個 RFC 都是 <code>46</code> 結尾，不知道是不是故意的。</p><p>值得一提的是，
<a href=https://zh.wikipedia.org/wiki/HTTP/2 title=HTTP/2 rel="noopener external nofollow noreferrer" target=_blank class=exturl>HTTP/2
<i class="fa fa-external-link-alt"></i></a> 協定是允許非加密的，同時也允許 TLS 1.2 或更新的版本，但目前主流瀏覽器都只實作加密的 HTTP/2，這讓 HTTP/2 + TLS 變成了強制標準。</p><h3 id=tls-運作原理>TLS 運作原理
<a class=header-anchor href=#tls-%e9%81%8b%e4%bd%9c%e5%8e%9f%e7%90%86></a></h3><p>TLS 在
<a href=https://en.wikipedia.org/wiki/OSI_model title="OSI 模型" rel="noopener external nofollow noreferrer" target=_blank class=exturl>OSI 模型
<i class="fa fa-external-link-alt"></i>
</a>裡，它屬於傳輸層的協定，而
<a href=https://ithelp.ithome.com.tw/articles/10217426 title="簡介 HTTP" rel="noopener external nofollow noreferrer" target=_blank class=exturl>簡介 HTTP
<i class="fa fa-external-link-alt"></i></a> 是有提到 HTTP 是應用層協定。而 OSI 模型在設計上是符合
<a href=https://ithelp.ithome.com.tw/articles/10192317 title=里氏替換原則 rel="noopener external nofollow noreferrer" target=_blank class=exturl>里氏替換原則
<i class="fa fa-external-link-alt"></i>
</a>與
<a href=https://ithelp.ithome.com.tw/articles/10192844 title=依賴反轉原則 rel="noopener external nofollow noreferrer" target=_blank class=exturl>依賴反轉原則
<i class="fa fa-external-link-alt"></i>
</a>的，這代表傳輸層是否有 TLS 是不會影響應用層的 HTTP；反之，不管應用層是 HTTP、
<a href=https://en.wikipedia.org/wiki/File_Transfer_Protocol title=FTP rel="noopener external nofollow noreferrer" target=_blank class=exturl>FTP
<i class="fa fa-external-link-alt"></i></a> 或
<a href=https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol title=SMTP rel="noopener external nofollow noreferrer" target=_blank class=exturl>SMTP
<i class="fa fa-external-link-alt"></i></a> 等，都能使用 TLS 加密。</p><h3 id=tcp-three-way-handshake>TCP Three-way Handshake
<a class=header-anchor href=#tcp-three-way-handshake></a></h3><p>傳輸層上還有另一個廣泛使用的協定－－
<a href=https://tools.ietf.org/html/rfc793 title="RFC 793 - Transmission Control Protocol（TCP）" rel="noopener external nofollow noreferrer" target=_blank class=exturl>RFC 793 - Transmission Control Protocol（TCP）
<i class="fa fa-external-link-alt"></i>
</a>，裡面有提到一開始建立連線的方法，即為
<a href=https://zh.wikipedia.org/wiki/%e4%bc%a0%e8%be%93%e6%8e%a7%e5%88%b6%e5%8d%8f%e8%ae%ae title="Three-way Handshake" rel="noopener external nofollow noreferrer" target=_blank class=exturl>Three-way Handshake
<i class="fa fa-external-link-alt"></i>
</a>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>@startuml
</span></span><span style=display:flex><span>Alice -&gt; Bob: SYN
</span></span><span style=display:flex><span>Alice &lt;- Bob: SYN-ACK
</span></span><span style=display:flex><span>Alice -&gt; Bob: ACK
</span></span><span style=display:flex><span>@enduml
</span></span></code></pre></div><p>簡單來說，這過程有點像在打電話：</p><ol><li><p>Alice：「喂？」</p></li><li><p>Bob：「喂？有聽到嗎？」</p></li><li><p>Alice：「有聽到了！」</p></li></ol><p>然後就可以開始正常講話了。</p><h3 id=https>HTTPS
<a class=header-anchor href=#https></a></h3><p>HTTPS 全名
<a href=https://zh.wikipedia.org/wiki/%e8%b6%85%e6%96%87%e6%9c%ac%e4%bc%a0%e8%be%93%e5%ae%89%e5%85%a8%e5%8d%8f%e8%ae%ae title=超文本傳輸安全協定 rel="noopener external nofollow noreferrer" target=_blank class=exturl>超文本傳輸安全協定
<i class="fa fa-external-link-alt"></i>
</a>，那個 S 就是 Secure 的意思；HTTPS 透過 HTTP 進行通訊，但通訊過程使用
<a href=https://zh.wikipedia.org/wiki/%e5%82%b3%e8%bc%b8%e5%b1%a4%e5%ae%89%e5%85%a8%e6%80%a7%e5%8d%94%e5%ae%9a title=SSL/TLS rel="noopener external nofollow noreferrer" target=_blank class=exturl>SSL/TLS
<i class="fa fa-external-link-alt"></i></a> 進行加密，藉由類似於前述的加密方式，在 HTTP 之上定義了相對安全的資料傳輸方法。</p><p>由於非對稱加密的運算量較高，傳遞回應較慢；實際的架構上，會透過公開金鑰加密傳遞出共用的金鑰，再透過共用金鑰加密進行後續的傳遞，兼顧了安全性及傳遞速度。</p><p>HTTPS (Hyper Text Transfer Protocol Secure，超級文字傳輸協議安全) 會在網站受到 SSL 憑證保護時在網址中出現。該憑證的詳細資料包括發行機構與網站擁有人的企業名稱，可以透過按一下瀏覽器列上的鎖定標記進行檢視。</p><p>基本的public key, private key 和 https的關系如下：</p><p>(1) 主機(server)上要先生成private key, public key兩把key。( 可以互相上鎖、解鎖 )</p><p>其中，private key要留在主機裡，public key則是公開給全世界知道</p><p>(2) 當一般使用者在瀏覽網頁時拿到這台主機的public key之後，browser就可以靠public key來加密，由此而建立https</p><p>然而，實際上，在(2) 的步驟，一般使用者拿到public key時，他心裡有一個疑問，「我怎麼知道，現在給我public key的你，沒有被別人冒用了呢？」 這種時候，使用者的瀏覽器就會冒出警告訊息，說收到的public key並沒有被認證過。</p><p>於是，為了電子商務的安全性，就要由第三方公正機關 「憑證中心」來代為處理這個「信賴」的問題。將上述的模型複雜化，引入了「憑證中心」這個角色之後，就變成如下：</p><p>(1) 主機(server)上要先生成private key, public key兩把key。( 可以互相上鎖、解鎖 )</p><p>其中，private key要留在主機裡，public key則是要先做加工之後，才可以讓全世界得知。</p><p>(2) public key送給憑證中心簽署認證。這種時候，因為要送public key和相關的一些網站基本資訊出去給憑證中心簽署認證，需要把public key放進一個文件檔，這個文件檔就叫做certificate signing request，副檔名通常是CSR</p><p>(3) 憑證中心簽署完畢後的public key，又可以稱之為ceriticate 。</p><p>certificate自憑證中心取回之後，要安裝入主機(server)，作為SSL的public key 來使用</p><p>(4) 當一般使用者在瀏覽網頁時拿到這台主機的public key( 這時候可以叫它certificate )之後，browser裡頭早就預先安裝好的憑證中心public key會認証這個certificate，然後回報說，這個網站的https是沒有問題的。於是browser就可以用public key來加密，由此而建立https ( 如此一來，browser就不會跳出警告訊息了。)</p><h3 id=憑證的信任機制>憑證的信任機制
<a class=header-anchor href=#%e6%86%91%e8%ad%89%e7%9a%84%e4%bf%a1%e4%bb%bb%e6%a9%9f%e5%88%b6></a></h3><p>一般來說，憑證要被信任，要滿足以下兩種需求之一：</p><ol><li><p>這張憑證是由某一個你信任的組織 (CA, Certificate Authority, 憑證授權中心) 簽發的 (root certificate, 根憑證)</p></li><li><p>憑證本身的 CA，又能夠證明是被 #1 裡面的 CA 信任的 (intermidiate certificate, 中介證書)</p></li></ol><p>通常 #1 比較單純，各家瀏覽器都會內建一份清單，記載有什麼 CA 是可以被相信的。要進入這個名單的流程非常的嚴謹，而且，由於事關重大，若 CA 做了什麼不太好的事情，那很快就會從這個清單內驅逐出去。不過實務上，除了看瀏覽器裡面的清單以外，也會看作業系統內帶的清單。兩份清單都可以自己做增減。</p><p>名單的控管，可以參考一下
<a href=https://www.mozilla.org/en-US/about/governance/policies/security-group/certs/ title="Mozilla CA Certificate Store" rel="noopener external nofollow noreferrer" target=_blank class=exturl>Mozilla CA Certificate Store
<i class="fa fa-external-link-alt"></i>
</a>，至於從名單內被驅逐出的範例，可以參考一下
<a href=https://blog.mozilla.org/security/2016/10/24/distrusting-new-wosign-and-startcom-certificates/ title=WoSign rel="noopener external nofollow noreferrer" target=_blank class=exturl>WoSign
<i class="fa fa-external-link-alt"></i></a> 和
<a href=https://blog.mozilla.org/security/2015/04/02/distrusting-new-cnnic-certificates/ title="中國官方的CA, CNNIC" rel="noopener external nofollow noreferrer" target=_blank class=exturl>中國官方的CA, CNNIC
<i class="fa fa-external-link-alt"></i>
</a>。</p><p>至於 #2 的部分，會需要「數位簽章」的機制來做驗證。</p><h3 id=數位簽章>數位簽章
<a class=header-anchor href=#%e6%95%b8%e4%bd%8d%e7%b0%bd%e7%ab%a0></a></h3><p>一張憑證可以被另一個授權中心做簽章的動作。正常狀況下，簽章代表著授權中心已經確認過原憑證持有方是真的擁有這個位置（網址）。實務上，這個授權中心會拿自己的私鑰去幫這張憑證的內容做加密，然後把這個密文嵌在憑證當中，當作數位簽章。這個流程和前述非對稱加密的流程是相反的，在數位簽章的狀況下，任何人都能拿這家憑證中心的公鑰去解開這張憑證，來確認這簽章是正常的。</p><p>所以流程是這樣：</p><ol><li><p>你要進行 HTTPS 連線，雙方做 Hello</p></li><li><p>伺服器丟一張憑證給你，憑證上面寫說他被某 CA 簽了</p></li><li><p>你剛好有這家 CA 的公鑰，拿公鑰解他的憑證，看是不是解的出來，內容是否正常</p></li><li><p>繼續下一步</p></li></ol><p>另外，這個方式可以連結很多張憑證，不過憑證一多，就要多花一點時間去檢查（重複2和3）。</p><h3 id=常見的狀況自簽憑證>常見的狀況：自簽憑證
<a class=header-anchor href=#%e5%b8%b8%e8%a6%8b%e7%9a%84%e7%8b%80%e6%b3%81%e8%87%aa%e7%b0%bd%e6%86%91%e8%ad%89></a></h3><p>因為之前提過，任何人都能夠隨便生憑證，重點是「這張憑證是否被大家相信」。有時候，在開發流程中，你會需要用 HTTPS，但你生不出一張正常的憑證（例如你根本沒網域，或是沒錢買，或是來不及弄），所以你就必須要自己當自己的 CA，然後自己用那個 CA 私鑰去生一張憑證出來。因為你自己的 CA 通常不會在信任名單裡面，所以大家跟你連線的時候，都會出現警示。</p><p>這種狀況下，你還是正在使用 HTTPS，所以資料傳輸過程有加密。不過，除非你將這張憑證加入信任清單，不然你沒有辦法防止別人做「中間人攻擊（即假裝他是那台伺服器）」。</p><h3 id=機制弱點>機制弱點
<a class=header-anchor href=#%e6%a9%9f%e5%88%b6%e5%bc%b1%e9%bb%9e></a></h3><p>前述提到，曾經發生過授權中心被除名的狀況。因為這些授權中心是可以讓任何憑證在大家的裝置上變得可用，因此，他們需要以非常嚴謹的態度來對待每一個憑證申請。被除名的 CNNIC，是因為某一間公司用中介證書簽了幾個 Google 網域底下的證書給其他人，而這張中介證書的根憑證是來自 CNNIC 的。因此，CNNIC 沒有做好管控措施，且這家公司是把憑證拿來做「竄改連線」的用途，因此就被除名了。</p><p>HTTPS 或是任何一個系統，都不是完全安全的。他防止不了有 CA 違規的情形、也防止不了你在服務裡面寫 shit logic。但是它還是一個很有效的資料傳輸方式。</p><h2 id=ssl-相關名詞>SSL 相關名詞
<a class=header-anchor href=#ssl-%e7%9b%b8%e9%97%9c%e5%90%8d%e8%a9%9e></a></h2><h4 id=tls-transport-layer-security-protocol>TLS: Transport Layer Security Protocol
<a class=header-anchor href=#tls-transport-layer-security-protocol></a></h4><p>在
<a href=https://jennycodes.me/posts/security-ssh#sshvsssl title=上一篇文 rel="noopener external nofollow noreferrer" target=_blank class=exturl>上一篇文
<i class="fa fa-external-link-alt"></i>
</a>中有稍微提到 TLS 的歷史，簡而言之，由於 SSL 已經不再安全（
<a href=https://en.wikipedia.org/wiki/POODLE title=POODLE rel="noopener external nofollow noreferrer" target=_blank class=exturl>POODLE
<i class="fa fa-external-link-alt"></i></a> 與
<a href=https://drownattack.com/ title=DROWN rel="noopener external nofollow noreferrer" target=_blank class=exturl>DROWN
<i class="fa fa-external-link-alt"></i></a> 是兩個曾經發生過的著名攻擊），所以現在已經被 TLS protocol 取代。慣性使然，當我們說 SSL（比如說 SSL 憑證）時，大部分情況其實是在說 TLS。</p><h4 id=ca-certificate-authority>CA: Certificate Authority
<a class=header-anchor href=#ca-certificate-authority></a></h4><p><a href=https://en.wikipedia.org/wiki/Certificate_authority title="數位憑證認證機構，簡稱 CA" rel="noopener external nofollow noreferrer" target=_blank class=exturl>數位憑證認證機構，簡稱 CA
<i class="fa fa-external-link-alt"></i>
</a>，是負責發放與管理數位憑證 （certificate）的單位。前面提到進行 SSL 連線的前置作業是 server 要提供數位憑證讓瀏覽器驗證，但瀏覽器要怎麼驗證？它會去看這個憑證是不是被一個它相信的 CA 簽署的。如果是，那瀏覽器就相信這個 server 可以信任，如果不是，那瀏覽器就再看這個 CA 有沒有它自己的 certificate，如果有，而這個 certificate 是被一個瀏覽器信任的 CA 簽的，那就放行，如果沒有，就再往下找。如果一路找下去，找不到可以信任的 CA，就失敗。</p><p>假設今天世界上有甲乙丙三家 CA。CA 丙簽了 CA 乙的憑證，而 CA 乙簽了 CA 甲的憑證。瀏覽器小明想連線到網站 A，而小明只知道 CA 丙。連線前，網站 A 傳了它的 certificate 們給小明。小明先看第一張，眉頭一皺，發現 A 的憑證是不認識的 CA 甲簽的，往下翻，看到 CA 乙簽了甲的憑證，但小明也不認識乙，所以繼續往下翻，下一張是乙的憑證，是 CA 丙簽署的 — bingo! 於是網站 A 順利與小明建立連線。</p><p>所以 CA 其實很像保證人的角色，它向瀏覽器保證一個網域的合法性，讓想要連線的那一方確保自己的連線對象是安全的。</p><h4 id=chain-of-trust>Chain of Trust
<a class=header-anchor href=#chain-of-trust></a></h4><p>這樣一層一層檢查 certificate，直到找到信任的 CA 的機制，叫做
<a href=https://en.wikipedia.org/wiki/Chain_of_trust title="chain of trust" rel="noopener external nofollow noreferrer" target=_blank class=exturl>chain of trust
<i class="fa fa-external-link-alt"></i>
</a>。你可能會疑惑，為什麼不直接讓所有 server 都帶著 CA 丙簽的 certificate 就好了？為什麼還需要經過這麼多層？主要原因是安全。如果今天壞人 B 找到一個破解 CA 甲的方法，可以偽造甲的簽名，這個漏洞一旦被發現，所有被甲簽過的憑證就都沒有意義了，那些網域必須要重新找 CA 來擔保自己的合法性。</p><p>使用 chain of trust 的好處是，它可以降低 root CA（chain of trust 的源頭 CA，就是例子中的 CA 丙）被暴露的風險。不過這也代表，要成為一個 root CA，安全防護必須要做到謹慎再謹慎，不然如果 root CA 的私鑰被攻破了，後果不堪設想。</p><p>OpenSSL
SSL/TLS 是 protocol，而
<a href=https://www.openssl.org/ title=OpenSSL rel="noopener external nofollow noreferrer" target=_blank class=exturl>OpenSSL
<i class="fa fa-external-link-alt"></i></a> 就是一個開源的實作（
<a href=https://jennycodes.me/posts/security-ssh#openssh title="SSH 與 OpenSSH" rel="noopener external nofollow noreferrer" target=_blank class=exturl>SSH 與 OpenSSH
<i class="fa fa-external-link-alt"></i></a> 也是同樣的關係）。如果你的電腦是 Unix 系列的，很大的機率是系統已經裝好 OpenSSL 了。如果是 Windows 系統，也可以直接去
<a href=https://www.openssl.org/source/ title=網站下載 rel="noopener external nofollow noreferrer" target=_blank class=exturl>網站下載
<i class="fa fa-external-link-alt"></i>
</a>最新的版本。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>$ openssl version
</span></span><span style=display:flex><span>LibreSSL 2.6.5
</span></span></code></pre></div><p>可以先打開終端機，試試 <code>version</code> 指令，如果有回傳版本給你，就代表你的電腦已經有 OpenSSL 了。</p><p>用 <code>$openssl help</code>（或是任何 OpenSSL 不認得的指令…）就可以看到 OpenSSL 提供的指令包。</p><p>openssh commands</p><p>其中 <code>s_client</code>是一個挺實用的工具，讓我們診斷與測試 SSL 的安全連線。下面示範測試 jennycodes.me 網站的 SSL 狀態。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>$ openssl s_client -connect jennycodes.me:443 -servername jennycodes.meCONNECTED(00000005)
</span></span><span style=display:flex><span>depth=2 C = IE, O = Baltimore, OU = CyberTrust, CN = Baltimore CyberTrust Root
</span></span><span style=display:flex><span>verify return:1
</span></span><span style=display:flex><span>depth=1 C = US, ST = CA, L = San Francisco, O = “CloudFlare, Inc.”, CN = CloudFlare Inc ECC CA-2
</span></span><span style=display:flex><span>verify return:1
</span></span><span style=display:flex><span>depth=0 C = US, ST = CA, L = San Francisco, O = “CloudFlare, Inc.”, CN = sni.cloudflaressl.com
</span></span><span style=display:flex><span>verify return:1
</span></span><span style=display:flex><span> — -
</span></span><span style=display:flex><span>Certificate chain
</span></span><span style=display:flex><span> 0 s:/C=US/ST=CA/L=San Francisco/O=CloudFlare, Inc./CN=sni.cloudflaressl.com
</span></span><span style=display:flex><span> i:/C=US/ST=CA/L=San Francisco/O=CloudFlare, Inc./CN=CloudFlare Inc ECC CA-2
</span></span><span style=display:flex><span> 1 s:/C=US/ST=CA/L=San Francisco/O=CloudFlare, Inc./CN=CloudFlare Inc ECC CA-2
</span></span><span style=display:flex><span> i:/C=IE/O=Baltimore/OU=CyberTrust/CN=Baltimore CyberTrust Root
</span></span><span style=display:flex><span> — -
</span></span><span style=display:flex><span>Server certificate
</span></span><span style=display:flex><span> — — -BEGIN CERTIFICATE — — -
</span></span><span style=display:flex><span>（略）
</span></span><span style=display:flex><span> — — -END CERTIFICATE — — -
</span></span><span style=display:flex><span>subject=/C=US/ST=CA/L=San Francisco/O=CloudFlare, Inc./CN=sni.cloudflaressl.com
</span></span><span style=display:flex><span>issuer=/C=US/ST=CA/L=San Francisco/O=CloudFlare, Inc./CN=CloudFlare Inc ECC CA-2
</span></span><span style=display:flex><span> — -
</span></span><span style=display:flex><span>No client certificate CA names sent
</span></span><span style=display:flex><span>Server Temp Key: ECDH, X25519, 253 bits
</span></span><span style=display:flex><span> — -
</span></span><span style=display:flex><span>SSL handshake has read 2642 bytes and written 307 bytes
</span></span><span style=display:flex><span> — -
</span></span><span style=display:flex><span>New, TLSv1/SSLv3, Cipher is ECDHE-ECDSA-CHACHA20-POLY1305
</span></span><span style=display:flex><span>Server public key is 256 bit
</span></span><span style=display:flex><span>Secure Renegotiation IS supported
</span></span><span style=display:flex><span>Compression: NONE
</span></span><span style=display:flex><span>Expansion: NONE
</span></span><span style=display:flex><span>No ALPN negotiated
</span></span><span style=display:flex><span>SSL-Session:
</span></span><span style=display:flex><span> Protocol : TLSv1.2
</span></span><span style=display:flex><span> Cipher : ECDHE-ECDSA-CHACHA20-POLY1305
</span></span><span style=display:flex><span> Session-ID: 5FEF2BA2A72483061BEB18C92222BBC507A1A95749AE67094F2863D537B7C600
</span></span><span style=display:flex><span> （略）
</span></span><span style=display:flex><span> Verify return code: 0 (ok)
</span></span><span style=display:flex><span> — -
</span></span><span style=display:flex><span>closed
</span></span><span style=display:flex><span> 
</span></span></code></pre></div><p>結果長這樣。解釋一下，我目前用的 SSL 是直接從 CloudFlare （CDN 伺服器）設定，不影響效用，但是 certificate 不會看到 jennycodes.me 的字樣。從上面一路看下來，<code>certificate chain</code> 的部分可以看到 openssl client 經過兩步 chain of trust 就認證了 jennycodes.me 網域（CloudFlare Inc ECC CA-2 -> Baltimore CyberTrust Root），緊接著的是 <code>server certificate</code> 內容，再下面可以注意的是 <code>SSL-Session</code> 下的 protocol 是用 <code>TLSv1.2</code>，而不是 SSL。</p><p>如果加上 <code>-state</code> 指令，變成：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>$openssl s_client -connect jennycodes.me:443 -servername jennycodes.me -state
</span></span><span style=display:flex><span> 
</span></span></code></pre></div><p>就會看到前面出現這段</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>SSL_connect:before/connect initialization 
</span></span><span style=display:flex><span>SSL_connect:SSLv3 write client hello A
</span></span><span style=display:flex><span>SSL_connect:SSLv3 read server hello A
</span></span><span style=display:flex><span>depth=2 C = IE, O = Baltimore, OU = CyberTrust, CN = Baltimore CyberTrust Root
</span></span><span style=display:flex><span>verify return:1
</span></span><span style=display:flex><span>depth=1 C = US, ST = CA, L = San Francisco, O = “CloudFlare, Inc.”, CN = CloudFlare Inc ECC CA-2
</span></span><span style=display:flex><span>verify return:1
</span></span><span style=display:flex><span>depth=0 C = US, ST = CA, L = San Francisco, O = “CloudFlare, Inc.”, CN = sni.cloudflaressl.com
</span></span><span style=display:flex><span>verify return:1
</span></span><span style=display:flex><span>SSL_connect:SSLv3 read server certificate A
</span></span><span style=display:flex><span>SSL_connect:SSLv3 read server key exchange A
</span></span><span style=display:flex><span>SSL_connect:SSLv3 read server done A
</span></span><span style=display:flex><span>SSL_connect:SSLv3 write client key exchange A
</span></span><span style=display:flex><span>SSL_connect:SSLv3 write change cipher spec A
</span></span><span style=display:flex><span>SSL_connect:SSLv3 write finished A
</span></span><span style=display:flex><span>SSL_connect:SSLv3 flush data
</span></span><span style=display:flex><span>SSL_connect:SSLv3 read server session ticket A
</span></span><span style=display:flex><span>SSL_connect:SSLv3 read finished A
</span></span></code></pre></div><p>這是連線前的握手過程，逐步確認 SSL 連線的步驟是否正確，滿好玩的。</p><p>再來，上面的指令只會顯示最前面那張 certificate 內容（也就是 server certificate）。如果想要看到所有的 certificate ，可以加上 <code>-showcerts</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>$openssl s_client -connect jennycodes.me:443 -servername jennycodes.me -showcerts
</span></span></code></pre></div><p>就可以拿到包含 root certificate 的所有憑證了。</p><p>光是 <code>s_client</code> 就有很多指令可以用，這邊送上
<a href=https://www.openssl.org/docs/man1.0.2/man1/openssl-s_client.html title="s_client 的 man page" rel="noopener external nofollow noreferrer" target=_blank class=exturl>s_client 的 man page
<i class="fa fa-external-link-alt"></i>
</a>，請好奇的人自行欣賞。</p><h2 id=參考>參考
<a class=header-anchor href=#%e5%8f%83%e8%80%83></a></h2><p>[Security] SSL — HTTPS 背後的功臣. Security 資訊安全系列文第三篇！ | by 施靜樺 | Starbugs Weekly 星巴哥技術專欄 | Medium</p><p><a href=https://medium.com/starbugs/security-ssl-https-%e8%83%8c%e5%be%8c%e7%9a%84%e5%8a%9f%e8%87%a3-df714e4df77b title=https://medium.com/starbugs/security-ssl-https-%E8%83%8C%E5%BE%8C%E7%9A%84%E5%8A%9F%E8%87%A3-df714e4df77b rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://medium.com/starbugs/security-ssl-https-%E8%83%8C%E5%BE%8C%E7%9A%84%E5%8A%9F%E8%87%A3-df714e4df77b
<i class="fa fa-external-link-alt"></i></a></p><p>HTTPS/SSL/TLS 概述，整體流程、憑證、數位簽章 - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天</p><p><a href=https://ithelp.ithome.com.tw/articles/10193095 title=https://ithelp.ithome.com.tw/articles/10193095 rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://ithelp.ithome.com.tw/articles/10193095
<i class="fa fa-external-link-alt"></i></a></p><p>SSL憑証(SSL certificate)的原理 - 知識庫 - 無限空間,虛擬主機,網域註冊,網域管理</p><p><a href="https://support.unethost.com/index.php?rp=/knowledgebase/82/SSLSSL-certificate.html" title="https://support.unethost.com/index.php?rp=/knowledgebase/82/SSLSSL-certificate.html" rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://support.unethost.com/index.php?rp=/knowledgebase/82/SSLSSL-certificate.html
<i class="fa fa-external-link-alt"></i></a></p><p>一文搞懂 HTTP 和 HTTPS 是什麼？兩者有什麼差別｜ALPHA Camp Blog</p><p><a href=https://tw.alphacamp.co/blog/http-https-difference title=https://tw.alphacamp.co/blog/http-https-difference rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://tw.alphacamp.co/blog/http-https-difference
<i class="fa fa-external-link-alt"></i></a></p><p>簡介 SSL、TLS 協定 - iT 邦幫忙::一起幫忙解決難題，拯救 IT 人的一天</p><p><a href=https://ithelp.ithome.com.tw/articles/10219106 title=https://ithelp.ithome.com.tw/articles/10219106 rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://ithelp.ithome.com.tw/articles/10219106
<i class="fa fa-external-link-alt"></i></a></p><p>網站SSL加密原理簡介 | 網管人</p><p><a href=https://www.netadmin.com.tw/netadmin/zh-tw/technology/6F6D669EB83E4DC9BEA42F1C94636D46 title=https://www.netadmin.com.tw/netadmin/zh-tw/technology/6F6D669EB83E4DC9BEA42F1C94636D46 rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://www.netadmin.com.tw/netadmin/zh-tw/technology/6F6D669EB83E4DC9BEA42F1C94636D46
<i class="fa fa-external-link-alt"></i></a></p></div><footer class=post-footer><div class=post-tags><a href=/tags/ssl>SSL</a>
<a href=/tags/tls>TLS</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
讚賞</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="Ian Huang - 支付寶">
<span>支付寶</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="Ian Huang - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知識><ul><li class=post-copyright-title><strong>文章標題：</strong>
SSlAndTLS</li><li class=post-copyright-author><strong>本文作者：</strong>
Ian Huang</li><li class=post-copyright-link><strong>本文鏈接：</strong>
<a id=post-cr-link href=https://iankingh.github.io/blog/post/net/sslandtlsandhttps/ title=SSlAndTLS>https://iankingh.github.io/blog/post/net/sslandtlsandhttps/</a></li><li class=post-copyright-license><strong>版權聲明：</strong>
本博客所有文章除特別聲明外，均採用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 許可協議。轉載請註明出處！</li></ul></div><div class="disqus markdown"><div id=disqus_thread></div><script type=text/javascript>(function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="https-iankingh-github-io",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the
<a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/blog/post/net/windowsnetcmd/ rel=next title=WindowsNetCmd><i class="fa fa-chevron-left"></i> WindowsNetCmd</a></div><div class="post-nav-prev post-nav-item"><a href=/blog/post/other/markdown/ rel=prev title=Markdown>Markdown
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2024</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>Ian Huang</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.112.3 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.5.3 target=_blank>Hugo NexT.Gemini</a> 強力驅動</div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://iankingh.github.io/blog/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小時前","ds_hours":" 小時 ","ds_just":"剛剛","ds_min":" 分鐘前","ds_mins":" 分鐘","ds_month":" 個月前","ds_years":" 年 ","empty":"沒有找到任何搜索結果：${query}","hits":"找到 ${hits} 個搜索結果","hits_time":"找到 ${hits} 個搜索結果（用時 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-TW","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/blog/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.5.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/blog/js/main.min.b0c78e5a4df586ee46d02716ffa91a4a322e56763e04e91eb2ba052c9469ed02.js defer></script></body></html>