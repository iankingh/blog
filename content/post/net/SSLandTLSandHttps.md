---
title: "SSlAndTLS"
date: 2020-12-23T11:38:01+08:00
draft: false
categories:
 - "ç­†è¨˜"
tags:
 - "SSL"
 - "TLS"
toc: true
---

# SSLã€TLS ä»¥åŠ HTTPS



ç•¶æˆ‘å€‘ç€è¦½ç¶²é æ™‚ï¼šç¶²å€åˆ—çš„é–‹é ­æ˜¯ä¸æ˜¯æœ‰å€‹ ğŸ”’é–çš„åœ–æ¡ˆã€‚

é€™å€‹é–ä»£è¡¨ä½ ç¾åœ¨é€£ç·šåˆ°çš„ç¶²ç«™æ˜¯å®‰å…¨å¯ä¿¡ä»»çš„ã€‚é€™å€‹é–çš„è¨˜è™Ÿä»£è¡¨ä½ èˆ‡é€™å€‹ç¶²ç«™æ˜¯ä½¿ç”¨å®‰å…¨çš„ [HTTPS (HTTP Secure)](https://en.wikipedia.org/wiki/HTTPS) é€£ç·šï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸å®‰å…¨çš„[ HTTP protocol](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol)ã€‚

<!--more-->



## SSLæ†‘è­‰(SSL certificate)çš„åŸç†

SSL çš„å…¨åæ˜¯ **Secure Sockets Layer**ï¼Œå³å®‰å…¨é€šè¨Šç«¯å±¤ï¼Œç°¡è€Œè¨€ä¹‹ï¼Œé€™æ˜¯ä¸€ç¨®æ¨™æº–çš„æŠ€è¡“ï¼Œç”¨æ–¼ä¿æŒç¶²éš›ç¶²è·¯é€£ç·šå®‰å…¨ä»¥åŠé˜²æ­¢åœ¨å…©å€‹ç³»çµ±ä¹‹é–“ç™¼é€çš„æ‰€æœ‰æ•æ„Ÿè³‡æ–™è¢«ç½ªçŠ¯è®€å–åŠä¿®æ”¹ä»»ä½•å‚³è¼¸çš„è³‡è¨Šï¼ŒåŒ…æ‹¬æ½›åœ¨çš„å€‹äººè©³ç´°è³‡æ–™ã€‚å…©å€‹ç³»çµ±å¯ä»¥æ˜¯ä¼ºæœå™¨èˆ‡ç”¨æˆ¶ç«¯ (ä¾‹å¦‚è³¼ç‰©ç¶²ç«™èˆ‡ç€è¦½å™¨)ï¼Œæˆ–è€…ä¼ºæœå™¨è‡³ä¼ºæœå™¨ (ä¾‹å¦‚ï¼Œå«æœ‰å€‹äººèº«ä»½è³‡è¨Šæˆ–å«æœ‰è–ªè³‡è³‡è¨Šçš„æ‡‰ç”¨ç¨‹å¼)ã€‚

é€™æ¨£åšæ˜¯ç‚ºäº†ç¢ºä¿ä½¿ç”¨è€…èˆ‡ç¶²ç«™ã€æˆ–å…©å€‹ç³»çµ±ä¹‹é–“å‚³è¼¸çš„ä»»ä½•è³‡æ–™ä¿æŒç„¡æ³•è¢«è®€å–çš„ç‹€æ…‹ã€‚æ­¤æŠ€è¡“å¯ä½¿ç”¨åŠ å¯†æ¼”ç®—æ³•ä»¥æ··æ·†è¼¸é€ä¸­çš„è³‡æ–™ï¼Œé˜²æ­¢é§­å®¢åœ¨è³‡æ–™é€éé€£ç·šç™¼é€æ™‚è®€å–è³‡æ–™ã€‚æ­¤è³‡è¨Šå¯èƒ½æ˜¯ä»»ä½•æ•æ„Ÿæˆ–å€‹äººè³‡è¨Šï¼ŒåŒ…æ‹¬ä¿¡ç”¨å¡è™Ÿèˆ‡å…¶ä»–è²¡å‹™è³‡è¨Šã€å§“åèˆ‡åœ°å€ã€‚

SSL è®“ç€è¦½å™¨ï¼ˆæ‰€è¬‚çš„ clientï¼‰è¦é€£åˆ°ä¸€å€‹é ç«¯ç¶²ç«™ï¼ˆæ‰€è¬‚çš„ serverï¼‰ä¹‹å‰ï¼Œå…ˆè¦æ±‚é€™å€‹ç¶²ç«™æä¾›èº«åˆ†èªè­‰ï¼Œè·Ÿé€™å€‹ç¶²ç«™ç´„å®šæš—è™Ÿï¼ˆäº¤æ›é‘°åŒ™ï¼‰ï¼Œæ‰“å¥½äº¤æƒ…ï¼ˆå»ºç«‹åŠ å¯†çš„ sessionï¼‰ï¼Œæ‰æœƒå¿ƒç”˜æƒ…é¡˜åœ°è·Ÿé€™å€‹ç¶²ç«™é€£ç·šã€‚

æ­¥é©Ÿï¼š

1. ç¢ºèªé€£ç·š  - å®¢æˆ¶ç«¯å’Œä¼ºæœå™¨å®˜è¡¨ç¤ºæƒ³è¦ç™¼èµ· HTTPS é€£ç·šï¼Œèªªæ˜è‡ªå·±æ”¯æŒçš„ SSL/TLS ç‰ˆæœ¬å’ŒåŠ å¯†ç®—æ³•ã€‚ä¼ºæœå™¨ç«¯æœƒå›æ‡‰å®¢æˆ¶ç«¯èªªå¯ä»¥ä½¿ç”¨å“ªä¸€ç¨®çµ„åˆã€‚ç€è¦½å™¨å°æƒ³è¦é€£ç·šçš„ç¶²ç«™é€å‡ºé€£ç·šè«‹æ±‚ï¼ŒåŒæ™‚è¦æ±‚ç¶²ç«™é©—è­‰è‡ªå·±ã€‚
2. æ†‘è­‰äº¤æ› - ä¼ºæœå™¨å¿…é ˆç…§æ˜_è‡ªå·±æ˜¯èª°_ã€‚ä¼ºæœå™¨æœƒæ‹¿å‡ºä¸€å¼µæ†‘è­‰ï¼ŒåŸºæœ¬ä¸Šé€™å¼µæ†‘è­‰è¨˜è¼‰äº†ä¼ºæœå™¨çš„èº«ä»½ã€ä½ç½®ï¼ˆç¶²å€ï¼‰ã€æ†‘è­‰çš„å…¬é‘°ã€æœ‰æ•ˆæ—¥æœŸå’Œæ•¸ä½ç°½ç« ã€‚å®¢æˆ¶ç«¯æœƒç¢ºèªæ˜¯å¦è¦ç›¸ä¿¡é€™å¼µæ†‘è­‰ï¼Œè¦éº¼é€™å¼µæ†‘è­‰æ˜¯è¢«è¨­å®šè¦ä¿¡ä»»ï¼Œè¦éº¼é€™å¼µæ†‘è­‰æ˜¯ç”±æŸå€‹ä¿¡ä»»çš„æ©Ÿæ§‹ (CA) ç°½ç½²çš„ã€‚å¦å¤–ï¼Œé€™å€‹æ©Ÿåˆ¶å…¶å¯¦å¯ä»¥é›™å‘ä½¿ç”¨ï¼Œä¼ºæœå™¨ç«¯é©—è­‰å®¢æˆ¶ç«¯çš„èº«ä»½ï¼Œä¸éé€™å€‹æ©Ÿåˆ¶å¾ˆå°‘ç”¨åˆ°
3. æ†‘è­‰äº¤æ› - ç¶²ç«™å°‡è‡ªå·±çš„ SSL æ•¸ä½æ†‘è­‰ (SSL certificate) å›å‚³çµ¦ clientï¼Œè£¡é¢åŒ…å«äº†ç¶²ç«™çš„ public key
4. æ†‘è­‰äº¤æ› - ç€è¦½å™¨é©—è­‰ç¶²ç«™å›å‚³çš„çš„ root certificateï¼Œé€é [chain of trust æ©Ÿåˆ¶](https://jennycodes.me/posts/security-ssl-https#chainoftrust) ç¢ºèªé€™å€‹è­‰æ˜æ–‡ä»¶æ˜¯å¦å¯ä»¥è¢«ä¿¡èªï¼ŒåŒæ™‚ä¹Ÿç¢ºèªé€™å€‹æ†‘è­‰æ˜¯å¦éæœŸã€‚
5. é‡‘é‘°äº¤æ›- ç•¶èªè­‰é€šéï¼Œç€è¦½å™¨æœƒç”¨ç¶²ç«™çš„ public key å»ºç«‹ä¸€å€‹ [symmetric session key](https://en.wikipedia.org/wiki/Session_key)ã€‚
6. é‡‘é‘°äº¤æ› - ç¶²ç«™ç”¨è‡ªå·±çš„ private key è§£è®€ session keyï¼Œä¸¦ä¸”å›å‚³ä¸€å€‹ç¢ºèªè¨Šæ¯ï¼Œé–‹å§‹ä¸€å€‹è¢« SSL ä¿è­·çš„ sessionã€‚
7. é‡‘é‘°äº¤æ› - é€™å€‹ session key æœƒè¢«ç”¨ä¾†åŠ å¯†æ‰€æœ‰ä¹‹å¾Œç€è¦½å™¨èˆ‡ç¶²ç«™ä¹‹é–“å‚³é€çš„è³‡æ–™ã€‚





### SSL Handshake

åœ¨ TCP Three-way Handshake å®Œæˆä¹‹å¾Œï¼Œå¦‚æœ Alice æœ‰å¸Œæœ›ä½¿ç”¨ SSL åŠ å¯†æ™‚å°±æœƒé–‹å§‹åš SSL Handshakeã€‚æ™‚åºåœ–å¦‚ä¸‹ï¼š

 

```
@startuml
Alice -> Bob: (1) hello
note left
  Highest SSL version
  Cipher supported
  Data Compression Method
  etc.
end note
Alice <- Bob: (2) hello
note right
  Selected SSL version
  Selected Cipher
  Selected Data Compression Method
  Certificate
  etc.
end note
Alice -> Alice: (3) Validate Certificate
Alice -> Bob: (4) Certificate
Bob -> Bob: (5) Validate Certificate
Alice -> Bob: (6) Key exchange
Alice -> Bob: (7) Change Cipher Spec
Alice -> Bob: (8) Finished
Alice <- Bob: (9) Change Cipher Spec
Alice <- Bob: (10) Finished
Alice <-> Bob: (11) Encrypted Data Transfer
@enduml
```



\1.  é¦–å…ˆç¬¬ä¸€æ­¥ Alice è·Ÿ Bob è¦æ±‚è¦ç”¨ SSL åŠ å¯†ï¼Œæ–¼æ˜¯ Alice å…ˆè·Ÿ Bob èªªå¥¹æ”¯æ´ä»€éº¼æ¨£çš„ç‰ˆæœ¬èˆ‡ç›¸é—œè³‡è¨Šç­‰

\2.  Bob å¦‚æœæœ‰æ”¯æ´çš„è©±ï¼Œå°±æœƒå›å‚³ä»–é¸äº†å“ªäº›ç‰ˆæœ¬ï¼ŒåŒæ™‚ä¹ŸæœƒæŠŠ Certificate å‚³é€çµ¦ Alice é©—è­‰

\3.  Alice æ‹¿åˆ° Certificate å¾Œï¼Œæœƒå…ˆé©—çœ‹çœ‹æ˜¯ä¸æ˜¯åˆæ³•çš„ï¼Œè‹¥æ˜¯ä¸åˆæ³•çš„ï¼Œå‰‡æœƒæå‡ºè­¦å‘Šè¨Šæ¯çµ¦ä½¿ç”¨è€…

\4.  ç¬¬äºŒæ­¥ Bob å¯ä»¥è¦æ±‚ Alice ä¹Ÿæä¾› Certificateï¼Œå¦‚æœæœ‰çš„è©±å°±æœƒå‚³çµ¦ Bob

\5.  åŒç¬¬ä¸‰æ­¥é©—è­‰

\6.  å†ä¾†å°±æ˜¯é‡‘é‘°ï¼ˆkeyï¼‰äº¤æ›ï¼Œé€™è£¡æœƒéš¨æ©Ÿç”¢ç”Ÿä¸€çµ„åšç‚ºå°ç¨±å¼åŠ å¯†ä½¿ç”¨çš„å¯†é‘°ï¼ˆsecretï¼‰

\7.  Alice æœƒè·Ÿ Bob èªªå¥½ï¼Œæ¥ä¸‹ä¾†è¦ç”¨ä»€éº¼æ¨£çš„æ–¹æ³•ä¾†åšè³‡æ–™åŠ å¯†

\8.  Bob æ”¶åˆ°è¨Šæ¯ä¸¦ç¢ºèªé€™æ˜¯ Alice ç™¼é€å‡ºä¾†çš„

\9.  Bob ä¹Ÿç™¼é€è¨Šæ¯é€šçŸ¥ Alice è¦ç”¨ä»€éº¼æ–¹æ³•åšè³‡æ–™åŠ å¯†

\10.   Alice æ‹¿åˆ°è¨Šæ¯ï¼Œä¹Ÿç¢ºèªå®Œæˆ

\11.   åˆ°æ­¤ç‚ºæ­¢ï¼Œå·²å¯é–‹å§‹ä½¿ç”¨åŠ å¯†è³‡æ–™å‚³è¼¸äº†



- `SSL 1.0` æ˜¯ç”±     Netscape è¨­è¨ˆçš„ï¼Œä½†æ™‚é–“ä¸è©³ã€‚
- `SSL 2.0` 1995 å¹´ç™¼å¸ƒï¼Œ2011     å¹´æ£„ç”¨ã€‚
- `SSL 3.0` 1996 å¹´ç™¼å¸ƒï¼Œ2015     å¹´æ£„ç”¨ã€‚å¾Œä¾†     IETF ä¹Ÿå°‡æ­¤å”å®šç‰¹åˆ¥ç™¼å¸ƒäº† [RFC      6101](https://tools.ietf.org/html/rfc6101) ä½œç‚ºæ­·å²è¨˜éŒ„ã€‚











## TLS



TSL çš„å…¨åæ˜¯ Transport Layer Security å‚³è¼¸å±¤å®‰å…¨æ€§)æ˜¯æ›´æ–°ã€æ›´å®‰å…¨çš„ SSL ç‰ˆæœ¬ã€‚æˆ‘å€‘ä»å°‡å®‰å…¨æ€§æ†‘è­‰ç¨±ç‚º SSLï¼Œå› ç‚ºé€™æ˜¯è¼ƒå¸¸ç”¨çš„è©å½™ï¼Œä¸éç•¶æ‚¨é€éDigiCert[è³¼è²· SSL ](https://www.websecurity.digicert.com/zh/tw/ssl-certificate?inid=infoctr_buylink_sslhome)æ™‚ï¼Œæ‚¨æ‰€è³¼è²·çš„å…¶å¯¦æ˜¯æœ€æ–°çš„ TLS æ†‘è­‰åŠ [ECCã€RSA æˆ– DSA çš„åŠ å¯†é¸é …](https://www.websecurity.digicert.com/zh/tw/security-topics/how-ssl-works)ã€‚

- `TLS 1.0` 1999 å¹´     IETF å°‡ SSL æ¨™æº–åŒ–ï¼Œç™¼å¸ƒäº† [RFC      2246](https://tools.ietf.org/html/rfc2246)ï¼ŒåŒæ™‚æ”¹åç‚º TLSã€‚ä¹Ÿå› æ­¤     SSL 3.0 å’Œ TLS 1.0 å…¶å¯¦æ²’æœ‰ä»€éº¼å¤ªå¤§å·®åˆ¥ï¼Œç”šè‡³å¯ä»¥èªªæ˜¯ä¸€æ¨£çš„æ±è¥¿ã€‚è€Œ     TLS 1.0 ä¹Ÿæ”¯æ´ç›¸å®¹ SSL 3.0 çš„åŠŸèƒ½ï¼Œä½†é€™åšæ³•åŒæ™‚ä¹Ÿé™ä½äº†å®‰å…¨æ€§ã€‚
- `TLS 1.1` 2006 å¹´ç™¼å¸ƒ [RFC      4346](https://tools.ietf.org/html/rfc4346)ï¼Œé›–ç„¶ç›®å‰æ²’ä»€éº¼å•é¡Œï¼Œé‚„æ˜¯è¨ˆåŠƒæ–¼ 2020 å¹´æ£„ç”¨
- `TLS 1.2` 2008 å¹´ç™¼å¸ƒ [RFC      5246](https://tools.ietf.org/html/rfc5246)ï¼Œå¯é‹ä½œåœ¨ HTTP/2 ä¸Šã€‚
- 2014 å¹´ï¼ŒGoogle ç™¼ç¾äº†     SSL 3.0 æœ‰è‡´å‘½çš„å®‰å…¨æ€§æ¼æ´ï¼ŒåŠ ä¸Š TLS 1.0 å› ç‚ºåŠ å¯†æ¨¡å¼è¨­è¨ˆä¸è‰¯ï¼Œæœƒ[é€ æˆåŠ å¯†å…§å®¹è¢«è§£å¯†](http://securityalley.blogspot.com/2014/07/ssltls-beast.html)ï¼Œå› æ­¤é¦¬ä¸Šè®Šæˆä¸»è¦çš„è³‡å®‰æª¢æ ¸é …ç›®ä¹‹ä¸€ï¼Œå»ºè­°æ—©æ—¥é—œé–‰ã€‚
- `TLS 1.3` 2018 å¹´ç™¼å¸ƒ [RFC      8446](https://tools.ietf.org/html/rfc8446)

æ³¨æ„çœ‹äº†ä¸€ä¸‹ï¼ŒTLS æ¯å€‹ RFC éƒ½æ˜¯ `46` çµå°¾ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æ•…æ„çš„ã€‚

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ[HTTP/2](https://zh.wikipedia.org/wiki/HTTP/2) å”å®šæ˜¯å…è¨±éåŠ å¯†çš„ï¼ŒåŒæ™‚ä¹Ÿå…è¨± TLS 1.2 æˆ–æ›´æ–°çš„ç‰ˆæœ¬ï¼Œä½†ç›®å‰ä¸»æµç€è¦½å™¨éƒ½åªå¯¦ä½œåŠ å¯†çš„ HTTP/2ï¼Œé€™è®“ HTTP/2 + TLS è®Šæˆäº†å¼·åˆ¶æ¨™æº–ã€‚



### TLS é‹ä½œåŸç†

TLS åœ¨ [OSI æ¨¡å‹](https://en.wikipedia.org/wiki/OSI_model)è£¡ï¼Œå®ƒå±¬æ–¼å‚³è¼¸å±¤çš„å”å®šï¼Œè€Œ[ç°¡ä»‹ HTTP](https://ithelp.ithome.com.tw/articles/10217426) æ˜¯æœ‰æåˆ° HTTP æ˜¯æ‡‰ç”¨å±¤å”å®šã€‚è€Œ OSI æ¨¡å‹åœ¨è¨­è¨ˆä¸Šæ˜¯ç¬¦åˆ[é‡Œæ°æ›¿æ›åŸå‰‡](https://ithelp.ithome.com.tw/articles/10192317)èˆ‡[ä¾è³´åè½‰åŸå‰‡](https://ithelp.ithome.com.tw/articles/10192844)çš„ï¼Œé€™ä»£è¡¨å‚³è¼¸å±¤æ˜¯å¦æœ‰ TLS æ˜¯ä¸æœƒå½±éŸ¿æ‡‰ç”¨å±¤çš„ HTTPï¼›åä¹‹ï¼Œä¸ç®¡æ‡‰ç”¨å±¤æ˜¯ HTTPã€[FTP](https://en.wikipedia.org/wiki/File_Transfer_Protocol) æˆ– [SMTP](https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol) ç­‰ï¼Œéƒ½èƒ½ä½¿ç”¨ TLS åŠ å¯†ã€‚



### TCP Three-way Handshake

å‚³è¼¸å±¤ä¸Šé‚„æœ‰å¦ä¸€å€‹å»£æ³›ä½¿ç”¨çš„å”å®šï¼ï¼[RFC 793 - Transmission Control Protocolï¼ˆTCPï¼‰](https://tools.ietf.org/html/rfc793)ï¼Œè£¡é¢æœ‰æåˆ°ä¸€é–‹å§‹å»ºç«‹é€£ç·šçš„æ–¹æ³•ï¼Œå³ç‚º [Three-way Handshake](https://zh.wikipedia.org/wiki/ä¼ è¾“æ§åˆ¶åè®®)ã€‚



 

```
@startuml
Alice -> Bob: SYN
Alice <- Bob: SYN-ACK
Alice -> Bob: ACK
@enduml
```

ç°¡å–®ä¾†èªªï¼Œé€™éç¨‹æœ‰é»åƒåœ¨æ‰“é›»è©±ï¼š

\1.  Aliceï¼šã€Œå–‚ï¼Ÿã€

\2.  Bobï¼šã€Œå–‚ï¼Ÿæœ‰è½åˆ°å—ï¼Ÿã€

\3.  Aliceï¼šã€Œæœ‰è½åˆ°äº†ï¼ã€

ç„¶å¾Œå°±å¯ä»¥é–‹å§‹æ­£å¸¸è¬›è©±äº†ã€‚



### HTTPS

HTTPS å…¨å [è¶…æ–‡æœ¬å‚³è¼¸å®‰å…¨å”å®š](https://zh.wikipedia.org/wiki/è¶…æ–‡æœ¬ä¼ è¾“å®‰å…¨åè®®)ï¼Œé‚£å€‹ S å°±æ˜¯ Secure çš„æ„æ€ï¼›HTTPS é€é HTTP é€²è¡Œé€šè¨Šï¼Œä½†é€šè¨Šéç¨‹ä½¿ç”¨ [SSL/TLS](https://zh.wikipedia.org/wiki/å‚³è¼¸å±¤å®‰å…¨æ€§å”å®š) é€²è¡ŒåŠ å¯†ï¼Œè—‰ç”±é¡ä¼¼æ–¼å‰è¿°çš„åŠ å¯†æ–¹å¼ï¼Œåœ¨ HTTP ä¹‹ä¸Šå®šç¾©äº†ç›¸å°å®‰å…¨çš„è³‡æ–™å‚³è¼¸æ–¹æ³•ã€‚

ç”±æ–¼éå°ç¨±åŠ å¯†çš„é‹ç®—é‡è¼ƒé«˜ï¼Œå‚³éå›æ‡‰è¼ƒæ…¢ï¼›å¯¦éš›çš„æ¶æ§‹ä¸Šï¼Œæœƒé€éå…¬é–‹é‡‘é‘°åŠ å¯†å‚³éå‡ºå…±ç”¨çš„é‡‘é‘°ï¼Œå†é€éå…±ç”¨é‡‘é‘°åŠ å¯†é€²è¡Œå¾ŒçºŒçš„å‚³éï¼Œå…¼é¡§äº†å®‰å…¨æ€§åŠå‚³éé€Ÿåº¦ã€‚

HTTPS (Hyper Text Transfer Protocol Secureï¼Œè¶…ç´šæ–‡å­—å‚³è¼¸å”è­°å®‰å…¨) æœƒåœ¨ç¶²ç«™å—åˆ° SSL æ†‘è­‰ä¿è­·æ™‚åœ¨ç¶²å€ä¸­å‡ºç¾ã€‚è©²æ†‘è­‰çš„è©³ç´°è³‡æ–™åŒ…æ‹¬ç™¼è¡Œæ©Ÿæ§‹èˆ‡ç¶²ç«™æ“æœ‰äººçš„ä¼æ¥­åç¨±ï¼Œå¯ä»¥é€éæŒ‰ä¸€ä¸‹ç€è¦½å™¨åˆ—ä¸Šçš„é–å®šæ¨™è¨˜é€²è¡Œæª¢è¦–ã€‚



åŸºæœ¬çš„public key, private key å’Œ httpsçš„é—œç³»å¦‚ä¸‹ï¼š

 

(1)  ä¸»æ©Ÿ(server)ä¸Šè¦å…ˆç”Ÿæˆprivate key, public keyå…©æŠŠkeyã€‚( å¯ä»¥äº’ç›¸ä¸Šé–ã€è§£é– )

   å…¶ä¸­ï¼Œprivate keyè¦ç•™åœ¨ä¸»æ©Ÿè£¡ï¼Œpublic keyå‰‡æ˜¯å…¬é–‹çµ¦å…¨ä¸–ç•ŒçŸ¥é“

 

(2) ç•¶ä¸€èˆ¬ä½¿ç”¨è€…åœ¨ç€è¦½ç¶²é æ™‚æ‹¿åˆ°é€™å°ä¸»æ©Ÿçš„public keyä¹‹å¾Œï¼Œbrowserå°±å¯ä»¥é public keyä¾†åŠ å¯†ï¼Œç”±æ­¤è€Œå»ºç«‹https

 

ç„¶è€Œï¼Œå¯¦éš›ä¸Šï¼Œåœ¨(2) çš„æ­¥é©Ÿï¼Œä¸€èˆ¬ä½¿ç”¨è€…æ‹¿åˆ°public keyæ™‚ï¼Œä»–å¿ƒè£¡æœ‰ä¸€å€‹ç–‘å•ï¼Œã€Œæˆ‘æ€éº¼çŸ¥é“ï¼Œç¾åœ¨çµ¦æˆ‘public keyçš„ä½ ï¼Œæ²’æœ‰è¢«åˆ¥äººå†’ç”¨äº†å‘¢ï¼Ÿã€ é€™ç¨®æ™‚å€™ï¼Œä½¿ç”¨è€…çš„ç€è¦½å™¨å°±æœƒå†’å‡ºè­¦å‘Šè¨Šæ¯ï¼Œèªªæ”¶åˆ°çš„public keyä¸¦æ²’æœ‰è¢«èªè­‰éã€‚

 

æ–¼æ˜¯ï¼Œç‚ºäº†é›»å­å•†å‹™çš„å®‰å…¨æ€§ï¼Œå°±è¦ç”±ç¬¬ä¸‰æ–¹å…¬æ­£æ©Ÿé—œ ã€Œæ†‘è­‰ä¸­å¿ƒã€ä¾†ä»£ç‚ºè™•ç†é€™å€‹ã€Œä¿¡è³´ã€çš„å•é¡Œã€‚å°‡ä¸Šè¿°çš„æ¨¡å‹è¤‡é›œåŒ–ï¼Œå¼•å…¥äº†ã€Œæ†‘è­‰ä¸­å¿ƒã€é€™å€‹è§’è‰²ä¹‹å¾Œï¼Œå°±è®Šæˆå¦‚ä¸‹ï¼š

 

(1) ä¸»æ©Ÿ(server)ä¸Šè¦å…ˆç”Ÿæˆprivate key, public keyå…©æŠŠkeyã€‚( å¯ä»¥äº’ç›¸ä¸Šé–ã€è§£é– )

   å…¶ä¸­ï¼Œprivate keyè¦ç•™åœ¨ä¸»æ©Ÿè£¡ï¼Œpublic keyå‰‡æ˜¯è¦å…ˆåšåŠ å·¥ä¹‹å¾Œï¼Œæ‰å¯ä»¥è®“å…¨ä¸–ç•Œå¾—çŸ¥ã€‚

 

(2) public keyé€çµ¦æ†‘è­‰ä¸­å¿ƒç°½ç½²èªè­‰ã€‚é€™ç¨®æ™‚å€™ï¼Œå› ç‚ºè¦é€public keyå’Œç›¸é—œçš„ä¸€äº›ç¶²ç«™åŸºæœ¬è³‡è¨Šå‡ºå»çµ¦æ†‘è­‰ä¸­å¿ƒç°½ç½²èªè­‰ï¼Œéœ€è¦æŠŠpublic keyæ”¾é€²ä¸€å€‹æ–‡ä»¶æª”ï¼Œé€™å€‹æ–‡ä»¶æª”å°±å«åšcertificate signing requestï¼Œå‰¯æª”åé€šå¸¸æ˜¯CSR )

 

(3) æ†‘è­‰ä¸­å¿ƒç°½ç½²å®Œç•¢å¾Œçš„public keyï¼Œåˆå¯ä»¥ç¨±ä¹‹ç‚ºceriticate ã€‚

   certificateè‡ªæ†‘è­‰ä¸­å¿ƒå–å›ä¹‹å¾Œï¼Œè¦å®‰è£å…¥ä¸»æ©Ÿ(server)ï¼Œä½œç‚ºSSLçš„public key ä¾†ä½¿ç”¨

 

(4) ç•¶ä¸€èˆ¬ä½¿ç”¨è€…åœ¨ç€è¦½ç¶²é æ™‚æ‹¿åˆ°é€™å°ä¸»æ©Ÿçš„public key( é€™æ™‚å€™å¯ä»¥å«å®ƒcertificate )ä¹‹å¾Œï¼Œbrowserè£¡é ­æ—©å°±é å…ˆå®‰è£å¥½çš„æ†‘è­‰ä¸­å¿ƒpublic keyæœƒèªè¨¼é€™å€‹certificateï¼Œç„¶å¾Œå›å ±èªªï¼Œé€™å€‹ç¶²ç«™çš„httpsæ˜¯æ²’æœ‰å•é¡Œçš„ã€‚æ–¼æ˜¯browserå°±å¯ä»¥ç”¨public keyä¾†åŠ å¯†ï¼Œç”±æ­¤è€Œå»ºç«‹https ( å¦‚æ­¤ä¸€ä¾†ï¼Œbrowserå°±ä¸æœƒè·³å‡ºè­¦å‘Šè¨Šæ¯äº†ã€‚)

 





### æ†‘è­‰çš„ä¿¡ä»»æ©Ÿåˆ¶

ä¸€èˆ¬ä¾†èªªï¼Œæ†‘è­‰è¦è¢«ä¿¡ä»»ï¼Œè¦æ»¿è¶³ä»¥ä¸‹å…©ç¨®éœ€æ±‚ä¹‹ä¸€ï¼š

\1.  é€™å¼µæ†‘è­‰æ˜¯ç”±æŸä¸€å€‹ä½ ä¿¡ä»»çš„çµ„ç¹” (CA, Certificate Authority, æ†‘è­‰æˆæ¬Šä¸­å¿ƒ) ç°½ç™¼çš„ (root certificate, æ ¹æ†‘è­‰)

\2.  æ†‘è­‰æœ¬èº«çš„ CAï¼Œåˆèƒ½å¤ è­‰æ˜æ˜¯è¢« #1 è£¡é¢çš„ CA ä¿¡ä»»çš„ (intermidiate certificate, ä¸­ä»‹è­‰æ›¸)

é€šå¸¸ #1 æ¯”è¼ƒå–®ç´”ï¼Œå„å®¶ç€è¦½å™¨éƒ½æœƒå…§å»ºä¸€ä»½æ¸…å–®ï¼Œè¨˜è¼‰æœ‰ä»€éº¼ CA æ˜¯å¯ä»¥è¢«ç›¸ä¿¡çš„ã€‚è¦é€²å…¥é€™å€‹åå–®çš„æµç¨‹éå¸¸çš„åš´è¬¹ï¼Œè€Œä¸”ï¼Œç”±æ–¼äº‹é—œé‡å¤§ï¼Œè‹¥ CA åšäº†ä»€éº¼ä¸å¤ªå¥½çš„äº‹æƒ…ï¼Œé‚£å¾ˆå¿«å°±æœƒå¾é€™å€‹æ¸…å–®å…§é©…é€å‡ºå»ã€‚ä¸éå¯¦å‹™ä¸Šï¼Œé™¤äº†çœ‹ç€è¦½å™¨è£¡é¢çš„æ¸…å–®ä»¥å¤–ï¼Œä¹Ÿæœƒçœ‹ä½œæ¥­ç³»çµ±å…§å¸¶çš„æ¸…å–®ã€‚å…©ä»½æ¸…å–®éƒ½å¯ä»¥è‡ªå·±åšå¢æ¸›ã€‚

åå–®çš„æ§ç®¡ï¼Œå¯ä»¥åƒè€ƒä¸€ä¸‹ [Mozilla CA Certificate Store](https://www.mozilla.org/en-US/about/governance/policies/security-group/certs/)ï¼Œè‡³æ–¼å¾åå–®å…§è¢«é©…é€å‡ºçš„ç¯„ä¾‹ï¼Œå¯ä»¥åƒè€ƒä¸€ä¸‹ [WoSign](https://blog.mozilla.org/security/2016/10/24/distrusting-new-wosign-and-startcom-certificates/) å’Œ [ä¸­åœ‹å®˜æ–¹çš„CA, CNNIC](https://blog.mozilla.org/security/2015/04/02/distrusting-new-cnnic-certificates/)ã€‚

è‡³æ–¼ #2 çš„éƒ¨åˆ†ï¼Œæœƒéœ€è¦ã€Œæ•¸ä½ç°½ç« ã€çš„æ©Ÿåˆ¶ä¾†åšé©—è­‰ã€‚

### æ•¸ä½ç°½ç« 

ä¸€å¼µæ†‘è­‰å¯ä»¥è¢«å¦ä¸€å€‹æˆæ¬Šä¸­å¿ƒåšç°½ç« çš„å‹•ä½œã€‚æ­£å¸¸ç‹€æ³ä¸‹ï¼Œç°½ç« ä»£è¡¨è‘—æˆæ¬Šä¸­å¿ƒå·²ç¶“ç¢ºèªéåŸæ†‘è­‰æŒæœ‰æ–¹æ˜¯çœŸçš„æ“æœ‰é€™å€‹ä½ç½®ï¼ˆç¶²å€ï¼‰ã€‚å¯¦å‹™ä¸Šï¼Œé€™å€‹æˆæ¬Šä¸­å¿ƒæœƒæ‹¿è‡ªå·±çš„ç§é‘°å»å¹«é€™å¼µæ†‘è­‰çš„å…§å®¹åšåŠ å¯†ï¼Œç„¶å¾ŒæŠŠé€™å€‹å¯†æ–‡åµŒåœ¨æ†‘è­‰ç•¶ä¸­ï¼Œç•¶ä½œæ•¸ä½ç°½ç« ã€‚é€™å€‹æµç¨‹å’Œå‰è¿°éå°ç¨±åŠ å¯†çš„æµç¨‹æ˜¯ç›¸åçš„ï¼Œåœ¨æ•¸ä½ç°½ç« çš„ç‹€æ³ä¸‹ï¼Œä»»ä½•äººéƒ½èƒ½æ‹¿é€™å®¶æ†‘è­‰ä¸­å¿ƒçš„å…¬é‘°å»è§£é–‹é€™å¼µæ†‘è­‰ï¼Œä¾†ç¢ºèªé€™ç°½ç« æ˜¯æ­£å¸¸çš„ã€‚

æ‰€ä»¥æµç¨‹æ˜¯é€™æ¨£ï¼š

\1.  ä½ è¦é€²è¡Œ HTTPS é€£ç·šï¼Œé›™æ–¹åš Hello

\2.  ä¼ºæœå™¨ä¸Ÿä¸€å¼µæ†‘è­‰çµ¦ä½ ï¼Œæ†‘è­‰ä¸Šé¢å¯«èªªä»–è¢«æŸ CA ç°½äº†

\3.  ä½ å‰›å¥½æœ‰é€™å®¶ CA çš„å…¬é‘°ï¼Œæ‹¿å…¬é‘°è§£ä»–çš„æ†‘è­‰ï¼Œçœ‹æ˜¯ä¸æ˜¯è§£çš„å‡ºä¾†ï¼Œå…§å®¹æ˜¯å¦æ­£å¸¸

\4.  ç¹¼çºŒä¸‹ä¸€æ­¥

å¦å¤–ï¼Œé€™å€‹æ–¹å¼å¯ä»¥é€£çµå¾ˆå¤šå¼µæ†‘è­‰ï¼Œä¸éæ†‘è­‰ä¸€å¤šï¼Œå°±è¦å¤šèŠ±ä¸€é»æ™‚é–“å»æª¢æŸ¥ï¼ˆé‡è¤‡2å’Œ3ï¼‰ã€‚

### å¸¸è¦‹çš„ç‹€æ³ï¼šè‡ªç°½æ†‘è­‰

å› ç‚ºä¹‹å‰æéï¼Œä»»ä½•äººéƒ½èƒ½å¤ éš¨ä¾¿ç”Ÿæ†‘è­‰ï¼Œé‡é»æ˜¯ã€Œé€™å¼µæ†‘è­‰æ˜¯å¦è¢«å¤§å®¶ç›¸ä¿¡ã€ã€‚æœ‰æ™‚å€™ï¼Œåœ¨é–‹ç™¼æµç¨‹ä¸­ï¼Œä½ æœƒéœ€è¦ç”¨ HTTPSï¼Œä½†ä½ ç”Ÿä¸å‡ºä¸€å¼µæ­£å¸¸çš„æ†‘è­‰ï¼ˆä¾‹å¦‚ä½ æ ¹æœ¬æ²’ç¶²åŸŸï¼Œæˆ–æ˜¯æ²’éŒ¢è²·ï¼Œæˆ–æ˜¯ä¾†ä¸åŠå¼„ï¼‰ï¼Œæ‰€ä»¥ä½ å°±å¿…é ˆè¦è‡ªå·±ç•¶è‡ªå·±çš„ CAï¼Œç„¶å¾Œè‡ªå·±ç”¨é‚£å€‹ CA ç§é‘°å»ç”Ÿä¸€å¼µæ†‘è­‰å‡ºä¾†ã€‚å› ç‚ºä½ è‡ªå·±çš„ CA é€šå¸¸ä¸æœƒåœ¨ä¿¡ä»»åå–®è£¡é¢ï¼Œæ‰€ä»¥å¤§å®¶è·Ÿä½ é€£ç·šçš„æ™‚å€™ï¼Œéƒ½æœƒå‡ºç¾è­¦ç¤ºã€‚

é€™ç¨®ç‹€æ³ä¸‹ï¼Œä½ é‚„æ˜¯æ­£åœ¨ä½¿ç”¨ HTTPSï¼Œæ‰€ä»¥è³‡æ–™å‚³è¼¸éç¨‹æœ‰åŠ å¯†ã€‚ä¸éï¼Œé™¤éä½ å°‡é€™å¼µæ†‘è­‰åŠ å…¥ä¿¡ä»»æ¸…å–®ï¼Œä¸ç„¶ä½ æ²’æœ‰è¾¦æ³•é˜²æ­¢åˆ¥äººåšã€Œä¸­é–“äººæ”»æ“Šï¼ˆå³å‡è£ä»–æ˜¯é‚£å°ä¼ºæœå™¨ï¼‰ã€ã€‚

### æ©Ÿåˆ¶å¼±é»

å‰è¿°æåˆ°ï¼Œæ›¾ç¶“ç™¼ç”Ÿéæˆæ¬Šä¸­å¿ƒè¢«é™¤åçš„ç‹€æ³ã€‚å› ç‚ºé€™äº›æˆæ¬Šä¸­å¿ƒæ˜¯å¯ä»¥è®“ä»»ä½•æ†‘è­‰åœ¨å¤§å®¶çš„è£ç½®ä¸Šè®Šå¾—å¯ç”¨ï¼Œå› æ­¤ï¼Œä»–å€‘éœ€è¦ä»¥éå¸¸åš´è¬¹çš„æ…‹åº¦ä¾†å°å¾…æ¯ä¸€å€‹æ†‘è­‰ç”³è«‹ã€‚è¢«é™¤åçš„ CNNICï¼Œæ˜¯å› ç‚ºæŸä¸€é–“å…¬å¸ç”¨ä¸­ä»‹è­‰æ›¸ç°½äº†å¹¾å€‹ Google ç¶²åŸŸåº•ä¸‹çš„è­‰æ›¸çµ¦å…¶ä»–äººï¼Œè€Œé€™å¼µä¸­ä»‹è­‰æ›¸çš„æ ¹æ†‘è­‰æ˜¯ä¾†è‡ª CNNIC çš„ã€‚å› æ­¤ï¼ŒCNNIC æ²’æœ‰åšå¥½ç®¡æ§æªæ–½ï¼Œä¸”é€™å®¶å…¬å¸æ˜¯æŠŠæ†‘è­‰æ‹¿ä¾†åšã€Œç«„æ”¹é€£ç·šã€çš„ç”¨é€”ï¼Œå› æ­¤å°±è¢«é™¤åäº†ã€‚

HTTPS æˆ–æ˜¯ä»»ä½•ä¸€å€‹ç³»çµ±ï¼Œéƒ½ä¸æ˜¯å®Œå…¨å®‰å…¨çš„ã€‚ä»–é˜²æ­¢ä¸äº†æœ‰ CA é•è¦çš„æƒ…å½¢ã€ä¹Ÿé˜²æ­¢ä¸äº†ä½ åœ¨æœå‹™è£¡é¢å¯« shit logicã€‚ä½†æ˜¯å®ƒé‚„æ˜¯ä¸€å€‹å¾ˆæœ‰æ•ˆçš„è³‡æ–™å‚³è¼¸æ–¹å¼ã€‚











## SSL ç›¸é—œåè©

### TLS: Transport Layer Security Protocol

åœ¨[ä¸Šä¸€ç¯‡æ–‡](https://jennycodes.me/posts/security-ssh#sshvsssl)ä¸­æœ‰ç¨å¾®æåˆ° TLS çš„æ­·å²ï¼Œç°¡è€Œè¨€ä¹‹ï¼Œç”±æ–¼ SSL å·²ç¶“ä¸å†å®‰å…¨ï¼ˆ[POODLE](https://en.wikipedia.org/wiki/POODLE) èˆ‡ [DROWN](https://drownattack.com/) æ˜¯å…©å€‹æ›¾ç¶“ç™¼ç”Ÿéçš„è‘—åæ”»æ“Šï¼‰ï¼Œæ‰€ä»¥ç¾åœ¨å·²ç¶“è¢« TLS protocol å–ä»£ã€‚æ…£æ€§ä½¿ç„¶ï¼Œç•¶æˆ‘å€‘èªª SSLï¼ˆæ¯”å¦‚èªª SSL æ†‘è­‰ï¼‰æ™‚ï¼Œå¤§éƒ¨åˆ†æƒ…æ³å…¶å¯¦æ˜¯åœ¨èªª TLSã€‚

### CA: Certificate Authority

[æ•¸ä½æ†‘è­‰èªè­‰æ©Ÿæ§‹ï¼Œç°¡ç¨± CA](https://en.wikipedia.org/wiki/Certificate_authority)ï¼Œæ˜¯è² è²¬ç™¼æ”¾èˆ‡ç®¡ç†æ•¸ä½æ†‘è­‰ ï¼ˆcertificateï¼‰çš„å–®ä½ã€‚å‰é¢æåˆ°é€²è¡Œ SSL é€£ç·šçš„å‰ç½®ä½œæ¥­æ˜¯ server è¦æä¾›æ•¸ä½æ†‘è­‰è®“ç€è¦½å™¨é©—è­‰ï¼Œä½†ç€è¦½å™¨è¦æ€éº¼é©—è­‰ï¼Ÿå®ƒæœƒå»çœ‹é€™å€‹æ†‘è­‰æ˜¯ä¸æ˜¯è¢«ä¸€å€‹å®ƒç›¸ä¿¡çš„ CA ç°½ç½²çš„ã€‚å¦‚æœæ˜¯ï¼Œé‚£ç€è¦½å™¨å°±ç›¸ä¿¡é€™å€‹ server å¯ä»¥ä¿¡ä»»ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£ç€è¦½å™¨å°±å†çœ‹é€™å€‹ CA æœ‰æ²’æœ‰å®ƒè‡ªå·±çš„ certificateï¼Œå¦‚æœæœ‰ï¼Œè€Œé€™å€‹ certificate æ˜¯è¢«ä¸€å€‹ç€è¦½å™¨ä¿¡ä»»çš„ CA ç°½çš„ï¼Œé‚£å°±æ”¾è¡Œï¼Œå¦‚æœæ²’æœ‰ï¼Œå°±å†å¾€ä¸‹æ‰¾ã€‚å¦‚æœä¸€è·¯æ‰¾ä¸‹å»ï¼Œæ‰¾ä¸åˆ°å¯ä»¥ä¿¡ä»»çš„ CAï¼Œå°±å¤±æ•—ã€‚

å‡è¨­ä»Šå¤©ä¸–ç•Œä¸Šæœ‰ç”²ä¹™ä¸™ä¸‰å®¶ CAã€‚CA ä¸™ç°½äº† CA ä¹™çš„æ†‘è­‰ï¼Œè€Œ CA ä¹™ç°½äº† CA ç”²çš„æ†‘è­‰ã€‚ç€è¦½å™¨å°æ˜æƒ³é€£ç·šåˆ°ç¶²ç«™ Aï¼Œè€Œå°æ˜åªçŸ¥é“ CA ä¸™ã€‚é€£ç·šå‰ï¼Œç¶²ç«™ A å‚³äº†å®ƒçš„ certificate å€‘çµ¦å°æ˜ã€‚å°æ˜å…ˆçœ‹ç¬¬ä¸€å¼µï¼Œçœ‰é ­ä¸€çšºï¼Œç™¼ç¾ A çš„æ†‘è­‰æ˜¯ä¸èªè­˜çš„ CA ç”²ç°½çš„ï¼Œå¾€ä¸‹ç¿»ï¼Œçœ‹åˆ° CA ä¹™ç°½äº†ç”²çš„æ†‘è­‰ï¼Œä½†å°æ˜ä¹Ÿä¸èªè­˜ä¹™ï¼Œæ‰€ä»¥ç¹¼çºŒå¾€ä¸‹ç¿»ï¼Œä¸‹ä¸€å¼µæ˜¯ä¹™çš„æ†‘è­‰ï¼Œæ˜¯ CA ä¸™ç°½ç½²çš„ â€” bingo! æ–¼æ˜¯ç¶²ç«™ A é †åˆ©èˆ‡å°æ˜å»ºç«‹é€£ç·šã€‚

æ‰€ä»¥ CA å…¶å¯¦å¾ˆåƒä¿è­‰äººçš„è§’è‰²ï¼Œå®ƒå‘ç€è¦½å™¨ä¿è­‰ä¸€å€‹ç¶²åŸŸçš„åˆæ³•æ€§ï¼Œè®“æƒ³è¦é€£ç·šçš„é‚£ä¸€æ–¹ç¢ºä¿è‡ªå·±çš„é€£ç·šå°è±¡æ˜¯å®‰å…¨çš„ã€‚

### Chain of Trust

é€™æ¨£ä¸€å±¤ä¸€å±¤æª¢æŸ¥ certificateï¼Œç›´åˆ°æ‰¾åˆ°ä¿¡ä»»çš„ CA çš„æ©Ÿåˆ¶ï¼Œå«åš [chain of trust](https://en.wikipedia.org/wiki/Chain_of_trust)ã€‚ä½ å¯èƒ½æœƒç–‘æƒ‘ï¼Œç‚ºä»€éº¼ä¸ç›´æ¥è®“æ‰€æœ‰ server éƒ½å¸¶è‘— CA ä¸™ç°½çš„ certificate å°±å¥½äº†ï¼Ÿç‚ºä»€éº¼é‚„éœ€è¦ç¶“éé€™éº¼å¤šå±¤ï¼Ÿä¸»è¦åŸå› æ˜¯å®‰å…¨ã€‚å¦‚æœä»Šå¤©å£äºº B æ‰¾åˆ°ä¸€å€‹ç ´è§£ CA ç”²çš„æ–¹æ³•ï¼Œå¯ä»¥å½é€ ç”²çš„ç°½åï¼Œé€™å€‹æ¼æ´ä¸€æ—¦è¢«ç™¼ç¾ï¼Œæ‰€æœ‰è¢«ç”²ç°½éçš„æ†‘è­‰å°±éƒ½æ²’æœ‰æ„ç¾©äº†ï¼Œé‚£äº›ç¶²åŸŸå¿…é ˆè¦é‡æ–°æ‰¾ CA ä¾†æ“”ä¿è‡ªå·±çš„åˆæ³•æ€§ã€‚

ä½¿ç”¨ chain of trust çš„å¥½è™•æ˜¯ï¼Œå®ƒå¯ä»¥é™ä½ root CAï¼ˆchain of trust çš„æºé ­ CAï¼Œå°±æ˜¯ä¾‹å­ä¸­çš„ CA ä¸™ï¼‰è¢«æš´éœ²çš„é¢¨éšªã€‚ä¸éé€™ä¹Ÿä»£è¡¨ï¼Œè¦æˆç‚ºä¸€å€‹ root CAï¼Œå®‰å…¨é˜²è­·å¿…é ˆè¦åšåˆ°è¬¹æ…å†è¬¹æ…ï¼Œä¸ç„¶å¦‚æœ root CA çš„ç§é‘°è¢«æ”»ç ´äº†ï¼Œå¾Œæœä¸å ªè¨­æƒ³ã€‚

OpenSSL
 SSL/TLS æ˜¯ protocolï¼Œè€Œ [OpenSSL](https://www.openssl.org/) å°±æ˜¯ä¸€å€‹é–‹æºçš„å¯¦ä½œï¼ˆ[SSH èˆ‡ OpenSSH](https://jennycodes.me/posts/security-ssh#openssh) ä¹Ÿæ˜¯åŒæ¨£çš„é—œä¿‚ï¼‰ã€‚å¦‚æœä½ çš„é›»è…¦æ˜¯ Unix ç³»åˆ—çš„ï¼Œå¾ˆå¤§çš„æ©Ÿç‡æ˜¯ç³»çµ±å·²ç¶“è£å¥½ OpenSSL äº†ã€‚å¦‚æœæ˜¯ Windows ç³»çµ±ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å»[ç¶²ç«™ä¸‹è¼‰](https://www.openssl.org/source/)æœ€æ–°çš„ç‰ˆæœ¬ã€‚

```
$ openssl version
LibreSSL 2.6.5
```

å¯ä»¥å…ˆæ‰“é–‹çµ‚ç«¯æ©Ÿï¼Œè©¦è©¦ `version` æŒ‡ä»¤ï¼Œå¦‚æœæœ‰å›å‚³ç‰ˆæœ¬çµ¦ä½ ï¼Œå°±ä»£è¡¨ä½ çš„é›»è…¦å·²ç¶“æœ‰ OpenSSL äº†ã€‚

ç”¨ `$openssl help`ï¼ˆæˆ–æ˜¯ä»»ä½• OpenSSL ä¸èªå¾—çš„æŒ‡ä»¤â€¦ï¼‰å°±å¯ä»¥çœ‹åˆ° OpenSSL æä¾›çš„æŒ‡ä»¤åŒ…ã€‚

 

â€‹                               

openssh commands

å…¶ä¸­ `s_client`æ˜¯ä¸€å€‹æŒºå¯¦ç”¨çš„å·¥å…·ï¼Œè®“æˆ‘å€‘è¨ºæ–·èˆ‡æ¸¬è©¦ SSL çš„å®‰å…¨é€£ç·šã€‚ä¸‹é¢ç¤ºç¯„æ¸¬è©¦ jennycodes.me ç¶²ç«™çš„ SSL ç‹€æ…‹ã€‚

```
$ openssl s_client -connect jennycodes.me:443 -servername jennycodes.meCONNECTED(00000005)
depth=2 C = IE, O = Baltimore, OU = CyberTrust, CN = Baltimore CyberTrust Root
verify return:1
depth=1 C = US, ST = CA, L = San Francisco, O = â€œCloudFlare, Inc.â€, CN = CloudFlare Inc ECC CA-2
verify return:1
depth=0 C = US, ST = CA, L = San Francisco, O = â€œCloudFlare, Inc.â€, CN = sni.cloudflaressl.com
verify return:1
 â€” -
Certificate chain
 0 s:/C=US/ST=CA/L=San Francisco/O=CloudFlare, Inc./CN=sni.cloudflaressl.com
 i:/C=US/ST=CA/L=San Francisco/O=CloudFlare, Inc./CN=CloudFlare Inc ECC CA-2
 1 s:/C=US/ST=CA/L=San Francisco/O=CloudFlare, Inc./CN=CloudFlare Inc ECC CA-2
 i:/C=IE/O=Baltimore/OU=CyberTrust/CN=Baltimore CyberTrust Root
 â€” -
Server certificate
 â€” â€” -BEGIN CERTIFICATE â€” â€” -
ï¼ˆç•¥ï¼‰
 â€” â€” -END CERTIFICATE â€” â€” -
subject=/C=US/ST=CA/L=San Francisco/O=CloudFlare, Inc./CN=sni.cloudflaressl.com
issuer=/C=US/ST=CA/L=San Francisco/O=CloudFlare, Inc./CN=CloudFlare Inc ECC CA-2
 â€” -
No client certificate CA names sent
Server Temp Key: ECDH, X25519, 253 bits
 â€” -
SSL handshake has read 2642 bytes and written 307 bytes
 â€” -
New, TLSv1/SSLv3, Cipher is ECDHE-ECDSA-CHACHA20-POLY1305
Server public key is 256 bit
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
No ALPN negotiated
SSL-Session:
 Protocol : TLSv1.2
 Cipher : ECDHE-ECDSA-CHACHA20-POLY1305
 Session-ID: 5FEF2BA2A72483061BEB18C92222BBC507A1A95749AE67094F2863D537B7C600
 ï¼ˆç•¥ï¼‰
 Verify return code: 0 (ok)
 â€” -
closed
 
```

çµæœé•·é€™æ¨£ã€‚è§£é‡‹ä¸€ä¸‹ï¼Œæˆ‘ç›®å‰ç”¨çš„ SSL æ˜¯ç›´æ¥å¾ CloudFlare ï¼ˆCDN ä¼ºæœå™¨ï¼‰è¨­å®šï¼Œä¸å½±éŸ¿æ•ˆç”¨ï¼Œä½†æ˜¯ certificate ä¸æœƒçœ‹åˆ° jennycodes.me çš„å­—æ¨£ã€‚å¾ä¸Šé¢ä¸€è·¯çœ‹ä¸‹ä¾†ï¼Œ`certificate chain` çš„éƒ¨åˆ†å¯ä»¥çœ‹åˆ° openssl client ç¶“éå…©æ­¥ chain of trust å°±èªè­‰äº† jennycodes.me ç¶²åŸŸï¼ˆCloudFlare Inc ECC CA-2 -> Baltimore CyberTrust Rootï¼‰ï¼Œç·Šæ¥è‘—çš„æ˜¯ `server certificate` å…§å®¹ï¼Œå†ä¸‹é¢å¯ä»¥æ³¨æ„çš„æ˜¯ `SSL-Session` ä¸‹çš„ protocol æ˜¯ç”¨ `TLSv1.2`ï¼Œè€Œä¸æ˜¯ SSLã€‚

å¦‚æœåŠ ä¸Š `-state` æŒ‡ä»¤ï¼Œè®Šæˆï¼š

```
$openssl s_client -connect jennycodes.me:443 -servername jennycodes.me -state
 
```

å°±æœƒçœ‹åˆ°å‰é¢å‡ºç¾é€™æ®µ

```
SSL_connect:before/connect initialization 
SSL_connect:SSLv3 write client hello A
SSL_connect:SSLv3 read server hello A
depth=2 C = IE, O = Baltimore, OU = CyberTrust, CN = Baltimore CyberTrust Root
verify return:1
depth=1 C = US, ST = CA, L = San Francisco, O = â€œCloudFlare, Inc.â€, CN = CloudFlare Inc ECC CA-2
verify return:1
depth=0 C = US, ST = CA, L = San Francisco, O = â€œCloudFlare, Inc.â€, CN = sni.cloudflaressl.com
verify return:1
SSL_connect:SSLv3 read server certificate A
SSL_connect:SSLv3 read server key exchange A
SSL_connect:SSLv3 read server done A
SSL_connect:SSLv3 write client key exchange A
SSL_connect:SSLv3 write change cipher spec A
SSL_connect:SSLv3 write finished A
SSL_connect:SSLv3 flush data
SSL_connect:SSLv3 read server session ticket A
SSL_connect:SSLv3 read finished A
```

é€™æ˜¯é€£ç·šå‰çš„æ¡æ‰‹éç¨‹ï¼Œé€æ­¥ç¢ºèª SSL é€£ç·šçš„æ­¥é©Ÿæ˜¯å¦æ­£ç¢ºï¼Œæ»¿å¥½ç©çš„ã€‚

å†ä¾†ï¼Œä¸Šé¢çš„æŒ‡ä»¤åªæœƒé¡¯ç¤ºæœ€å‰é¢é‚£å¼µ certificate å…§å®¹ï¼ˆä¹Ÿå°±æ˜¯ server certificateï¼‰ã€‚å¦‚æœæƒ³è¦çœ‹åˆ°æ‰€æœ‰çš„ certificate ï¼Œå¯ä»¥åŠ ä¸Š `-showcerts`ï¼š

```
$openssl s_client -connect jennycodes.me:443 -servername jennycodes.me -showcerts
```

å°±å¯ä»¥æ‹¿åˆ°åŒ…å« root certificate çš„æ‰€æœ‰æ†‘è­‰äº†ã€‚

å…‰æ˜¯ `s_client` å°±æœ‰å¾ˆå¤šæŒ‡ä»¤å¯ä»¥ç”¨ï¼Œé€™é‚Šé€ä¸Š [s_client çš„ man page](https://www.openssl.org/docs/man1.0.2/man1/openssl-s_client.html)ï¼Œè«‹å¥½å¥‡çš„äººè‡ªè¡Œæ¬£è³ã€‚

## åƒè€ƒ

[Security] SSL â€” HTTPS èƒŒå¾Œçš„åŠŸè‡£. Security è³‡è¨Šå®‰å…¨ç³»åˆ—æ–‡ç¬¬ä¸‰ç¯‡ï¼ | by æ–½éœæ¨º | Starbugs Weekly æ˜Ÿå·´å“¥æŠ€è¡“å°ˆæ¬„ | Medium

[https://medium.com/starbugs/security-ssl-https-%E8%83%8C%E5%BE%8C%E7%9A%84%E5%8A%9F%E8%87%A3-df714e4df77b](https://medium.com/starbugs/security-ssl-https-èƒŒå¾Œçš„åŠŸè‡£-df714e4df77b)

HTTPS/SSL/TLS æ¦‚è¿°ï¼Œæ•´é«”æµç¨‹ã€æ†‘è­‰ã€æ•¸ä½ç°½ç«  - iT é‚¦å¹«å¿™::ä¸€èµ·å¹«å¿™è§£æ±ºé›£é¡Œï¼Œæ‹¯æ•‘ IT äººçš„ä¸€å¤©

https://ithelp.ithome.com.tw/articles/10193095

SSLæ†‘è¨¼(SSL certificate)çš„åŸç† - çŸ¥è­˜åº« - ç„¡é™ç©ºé–“,è™›æ“¬ä¸»æ©Ÿ,ç¶²åŸŸè¨»å†Š,ç¶²åŸŸç®¡ç†

https://support.unethost.com/index.php?rp=/knowledgebase/82/SSLSSL-certificate.html

ä¸€æ–‡ææ‡‚ HTTP å’Œ HTTPS æ˜¯ä»€éº¼ï¼Ÿå…©è€…æœ‰ä»€éº¼å·®åˆ¥ï½œALPHA Camp Blog

https://tw.alphacamp.co/blog/http-https-difference

ç°¡ä»‹ SSLã€TLS å”å®š - iT é‚¦å¹«å¿™::ä¸€èµ·å¹«å¿™è§£æ±ºé›£é¡Œï¼Œæ‹¯æ•‘ IT äººçš„ä¸€å¤©

https://ithelp.ithome.com.tw/articles/10219106

ç¶²ç«™SSLåŠ å¯†åŸç†ç°¡ä»‹ | ç¶²ç®¡äºº

https://www.netadmin.com.tw/netadmin/zh-tw/technology/6F6D669EB83E4DC9BEA42F1C94636D46





